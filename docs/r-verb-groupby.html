<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Reporting - 18&nbsp; Verbs in depth: Aggregating with groups</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./r-verb-join.html" rel="next">
<link href="./r-groupby-story.html" rel="prev">
<link href="./assets/images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rdepth.html">Verbs of the tidyverse</a></li><li class="breadcrumb-item"><a href="./r-verb-groupby.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verbs in depth: Aggregating with groups</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/images/favicon.ico" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Reporting</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/cronkitedata/djtextbook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reporting with data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Learn a new way to read</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Newsroom math</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-data-def.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Defining “Data”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-data-document.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Documenting your work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-hunt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Finding the right data for your story</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-build-own.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Build your own database</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming quick start</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">A gentle intro to programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-startup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Getting started with R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Getting and saving data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">A quick tour of verbs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rdepth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Verbs of the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Tidy data principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-filter-sort-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Sorting and filtering to find stories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Verbs in depth: Select, arrange, filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-mutate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Verbs in depth: New from old data with Mutate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-groupby-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Summarizing detail into totals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-groupby.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verbs in depth: Aggregating with groups</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Verbs in depth: Matchmaking with joins</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Newsroom numbers cheat sheet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-filetypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">File types in the wild</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-ppp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Documentation for PPP data chapters</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter:</h2>
   
  <ul>
  <li><a href="#summarize-for-statistics" id="toc-summarize-for-statistics" class="nav-link active" data-scroll-target="#summarize-for-statistics"><span class="header-section-number">18.1</span> <code>summarize</code> for statistics</a>
  <ul class="collapse">
  <li><a href="#the-dreaded-na" id="toc-the-dreaded-na" class="nav-link" data-scroll-target="#the-dreaded-na">The dreaded <code>NA</code></a></li>
  <li><a href="#summary-functions" id="toc-summary-functions" class="nav-link" data-scroll-target="#summary-functions">Summary functions</a></li>
  </ul></li>
  <li><a href="#grouping-for-lists" id="toc-grouping-for-lists" class="nav-link" data-scroll-target="#grouping-for-lists"><span class="header-section-number">18.2</span> Grouping for lists</a>
  <ul class="collapse">
  <li><a href="#grouping-by-one-column" id="toc-grouping-by-one-column" class="nav-link" data-scroll-target="#grouping-by-one-column">Grouping by one column</a></li>
  <li><a href="#grouping-by-more-than-one-column" id="toc-grouping-by-more-than-one-column" class="nav-link" data-scroll-target="#grouping-by-more-than-one-column">Grouping by more than one column</a></li>
  <li><a href="#a-shortcut-count" id="toc-a-shortcut-count" class="nav-link" data-scroll-target="#a-shortcut-count">A shortcut : <code>count()</code></a></li>
  </ul></li>
  <li><a href="#using-and-converting-groups" id="toc-using-and-converting-groups" class="nav-link" data-scroll-target="#using-and-converting-groups"><span class="header-section-number">18.3</span> Using and converting groups</a>
  <ul class="collapse">
  <li><a href="#converting-from-long-to-wide-data" id="toc-converting-from-long-to-wide-data" class="nav-link" data-scroll-target="#converting-from-long-to-wide-data">Converting from long to wide data</a></li>
  <li><a href="#totals-and-subtotals" id="toc-totals-and-subtotals" class="nav-link" data-scroll-target="#totals-and-subtotals">Totals and subtotals</a></li>
  </ul></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">18.4</span> Practice</a></li>
  <li><a href="#understanding-grouped-data" id="toc-understanding-grouped-data" class="nav-link" data-scroll-target="#understanding-grouped-data"><span class="header-section-number">18.5</span> Postscript: Understanding grouped data</a>
  <ul class="collapse">
  <li><a href="#what-does-tidy-data-have-to-do-with-groupings" id="toc-what-does-tidy-data-have-to-do-with-groupings" class="nav-link" data-scroll-target="#what-does-tidy-data-have-to-do-with-groupings">What does “tidy” data have to do with groupings?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="r-verb-groupby" class="quarto-section-identifier"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verbs in depth: Aggregating with groups</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This chapter continues with the Paycheck Protection Program, or PPP, loans in Arizona. Full documentation of the dataset is in the <a href="appendix-ppp.html">Appendix</a>. If you haven’t already, look through that documentation before you start.</p>
<div class="callout-dothis">
<p>To follow along, open your R project and create a new Quarto document with the <a href="https://gist.github.com/sarahcnyt/e60ad2d7ccf65498fc88791f3bb683ae">front matter and libraries</a>.</p>
<p>Then load the saved PPP data with this code chunk:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="ot">&lt;-</span> <span class="fu">readRDS</span> (</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">url</span> ( </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"https://cronkitedata.s3.amazonaws.com/rdata/ppp_az_loans.RDS"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="summarize-for-statistics" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="summarize-for-statistics"><span class="header-section-number">18.1</span> <code>summarize</code> for statistics</h2>
<p><code>summarize</code> computes summary statistics such as the number of rows in a data frame or the sum of dollar values. It removes the original columns completely, and only produces the summary statistics you compute within that statement. <strong>Using <code>summarize</code> alone produces a data frame with one row.</strong> It’s the equivalent of putting nothing in your pivot table in Excel other than the “Values” area.</p>
<p>Another way to think of <code>summarize</code> is that it collapses your list of items (loans, in our example) into a statistical report.</p>
<section id="the-dreaded-na" class="level3">
<h3 class="anchored" data-anchor-id="the-dreaded-na">The dreaded <code>NA</code></h3>
<p>You saw in the <code>mutate</code> section that missing values are always a problem. Because they’re unknown, they can’t match anything else, they can’t be considered 0, and they can warp any answers you get. But there’s usually nothing you can do about missing data, so you have to tell the program exactly what to do about them.</p>
<p>There are two choices:</p>
<ul>
<li>Let them infect everything they touch, turning everything into <code>NA</code>. In this scenario, a total of the dollar values in a column would be NA if <strong>any</strong> of the values in that column is missing:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">total =</span> <span class="fu">sum</span>(forgiveness_amount))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["total"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li>Ignore them in a computation completely, effectively removing that value from your calculation.</li>
</ul>
<p>There’s no right answer, and it depends on what you’re doing. In some cases, you know that they stand for the value <code>0</code>, and in others you don’t. We will usually ignore them by adding an <em>argument</em> to every summary function that could be infected by them : <code>na.rm = TRUE</code> , which means, “remove NA’s before you do anything.”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">total =</span> <span class="fu">sum</span> (forgiveness_amount, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["total"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"11751650990"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="summary-functions" class="level3">
<h3 class="anchored" data-anchor-id="summary-functions">Summary functions</h3>
<p>Some of the common functions you’ll use to summarize are :</p>
<ul>
<li><code>mean (column_name, na.rm=T)</code> – for an average : Numbers only</li>
<li><code>sum (column_name, na.rm = T)</code>: Numbers only</li>
<li><code>n()</code> – for “how many”, or “count”. Anything - this counts rows, not values</li>
<li><code>n_distinct ( column_name)</code> : The number of unique entries in the column. Use it to see how many categories there are in a column.</li>
<li><code>median (column_name, na.rm=T)</code>: Numbers only</li>
<li><code>min (column_name, na.rm=T)</code>: Dates and numbers</li>
<li><code>max (column_name , na.rm=T)</code>: Dates and numbers</li>
</ul>
<p>When used on the whole data frame, it’s customary to just glimpse the output, since there’s only one row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="fu">n</span>(), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span> (amount, <span class="at">na.rm=</span>T), </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span> (forgiveness_amount, <span class="at">na.rm=</span>T), </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">min</span> (date_approved, <span class="at">na.rm=</span>T), </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">max</span> (date_approved, <span class="at">na.rm=</span> T), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">n_distinct</span> ( business_type)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 6
$ `n()`                                 &lt;int&gt; 169259
$ `mean(amount, na.rm = T)`             &lt;dbl&gt; 73206.66
$ `mean(forgiveness_amount, na.rm = T)` &lt;dbl&gt; 77050.41
$ `min(date_approved, na.rm = T)`       &lt;date&gt; 2020-04-03
$ `max(date_approved, na.rm = T)`       &lt;date&gt; 2021-06-29
$ `n_distinct(business_type)`           &lt;int&gt; 24</code></pre>
</div>
</div>
<p>This produced a data frame with 1 row and 5 columns. The column names are the same as the formulas that created them, which is difficult to work with. Create new column names using the name (in back-ticks if it’s got spaces or special characters) and assign them the values of the summaries using the <code>=</code> sign:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">number_of_rows =</span>  <span class="fu">n</span>(), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_amount =</span> <span class="fu">mean</span> (amount, <span class="at">na.rm=</span>T),    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">median_amount =</span> <span class="fu">median</span> (amount, <span class="at">na.rm=</span>T),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_forgiven =</span> <span class="fu">mean</span> (forgiveness_amount, <span class="at">na.rm=</span>T),   </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">first_loan =</span> <span class="fu">min</span> (date_approved, <span class="at">na.rm=</span>T),   </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">last_loan =</span> <span class="fu">max</span> (date_approved, <span class="at">na.rm=</span> T), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">business_type_count =</span> <span class="fu">n_distinct</span>(business_type)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ number_of_rows      &lt;int&gt; 169259
$ mean_amount         &lt;dbl&gt; 73206.66
$ median_amount       &lt;dbl&gt; 20800
$ mean_forgiven       &lt;dbl&gt; 77050.41
$ first_loan          &lt;date&gt; 2020-04-03
$ last_loan           &lt;date&gt; 2021-06-29
$ business_type_count &lt;int&gt; 24</code></pre>
</div>
</div>
<p>Note that the mean forgiven removes those with missing values for the forgiven amount, which is wrong! We need to turn them into zeroes first.</p>
</section>
</section>
<section id="grouping-for-lists" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="grouping-for-lists"><span class="header-section-number">18.2</span> Grouping for lists</h2>
<p>Now that you know how to summarize the whole data frame, you’ll want to start getting totals by category. This is the same thing as a pivot table in spreadsheets: the column names that create the “groups” are the equivalent of the Rows area a spreadsheet pivot table:</p>
<p><img src="assets/images/r-verb-group-pivotcompare.png" class="img-fluid" style="width:100.0%"></p>
<section id="grouping-by-one-column" class="level3">
<h3 class="anchored" data-anchor-id="grouping-by-one-column">Grouping by one column</h3>
<p>In the PPP data, the “draw” refers to which of the two programs was involved - the original one created in April 2020, or the one with stricter criteria passed by Congress that December.</p>
<p>Here’s how we’d get some key statistics by draw:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( draw ) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">first_loan =</span> <span class="fu">min</span> ( date_approved ), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_amount =</span> <span class="fu">sum</span> (amount), </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_forgiven =</span> <span class="fu">sum</span> (forgiveness_amount, <span class="at">na.rm=</span>T), </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at"># of loans</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>() </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["draw"],"name":[1],"type":["chr"],"align":["left"]},{"label":["first_loan"],"name":[2],"type":["date"],"align":["right"]},{"label":["total_amount"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["total_forgiven"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["# of loans"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"First","2":"2020-04-03","3":"9465606369","4":"8972228355","5":"128715"},{"1":"Second","2":"2021-01-14","3":"2925279615","4":"2779422635","5":"40544"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Here are a couple of things to note about grouped output:</p>
<ul>
<li>The only columns saved are the ones that are shown in either the <code>group_by</code> or <code>summarize</code> rows. All of the other original columns have been eliminated. You no longer have them to work with .</li>
<li>The names of the columns for the summary statistics are the ones defined before the “=” sign in the summarize statement.</li>
<li>TRAP! Don’t ever name your summary columns the same thing as a group_by column. It will override those names, and your output will be unintelligible.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Naming your columns
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the name of the columns doesn’t always follow our standard. In this case, <code># of loans</code> has a special character and spaces. In order to create or use it, you must enclose them in back-tics (`) or you’ll get an error.</p>
</div>
</div>
</section>
<section id="grouping-by-more-than-one-column" class="level3">
<h3 class="anchored" data-anchor-id="grouping-by-more-than-one-column">Grouping by more than one column</h3>
<p>If you wanted to know the numbers outstanding and forgiven by draw, you could add another column to the group by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( loan_status, draw ) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">first_loan =</span> <span class="fu">min</span> ( date_approved ), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_amount =</span> <span class="fu">sum</span> (amount), </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_forgiven =</span> <span class="fu">sum</span> (forgiveness_amount, <span class="at">na.rm=</span>T), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">loan_ct =</span> <span class="fu">n</span>() </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["loan_status"],"name":[1],"type":["chr"],"align":["left"]},{"label":["draw"],"name":[2],"type":["chr"],"align":["left"]},{"label":["first_loan"],"name":[3],"type":["date"],"align":["right"]},{"label":["total_amount"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["total_forgiven"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["loan_ct"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"Active Un-Disbursed","2":"First","3":"2021-02-23","4":"61053","5":"0","6":"3"},{"1":"Exemption 4","2":"First","3":"2020-04-03","4":"488322977","5":"109392926","6":"13573"},{"1":"Exemption 4","2":"Second","3":"2021-01-16","4":"212558139","5":"54122380","6":"3898"},{"1":"Paid in Full","2":"First","3":"2020-04-03","4":"8977222339","5":"8862835430","6":"115139"},{"1":"Paid in Full","2":"Second","3":"2021-01-14","4":"2712721476","5":"2725300255","6":"36646"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="a-shortcut-count" class="level3">
<h3 class="anchored" data-anchor-id="a-shortcut-count">A shortcut : <code>count()</code></h3>
<p>If all you want to do is count or add by group, you can use the <code>count()</code> function as a shortcut. It does the exact same thing as a combination of <code>group_by()</code> and <code>summarize( n() )</code> and <code>arrange()</code>` to get the number of items in each category, sorted by the most frequent to least:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span> ( loan_status, draw, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">sort=</span><span class="cn">TRUE</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">name =</span> <span class="st">"loan_ct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["loan_status"],"name":[1],"type":["chr"],"align":["left"]},{"label":["draw"],"name":[2],"type":["chr"],"align":["left"]},{"label":["loan_ct"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Paid in Full","2":"First","3":"115139"},{"1":"Paid in Full","2":"Second","3":"36646"},{"1":"Exemption 4","2":"First","3":"13573"},{"1":"Exemption 4","2":"Second","3":"3898"},{"1":"Active Un-Disbursed","2":"First","3":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
New ways to summarize
</div>
</div>
<div class="callout-body-container callout-body">
<p>A new version of the tidyverse, in 2023, has changed some of the options for the <code>summarize()</code> verb that make grouping unnecessary much of the time, but it’s confusing. I’m skipping it for now.</p>
</div>
</div>
</section>
</section>
<section id="using-and-converting-groups" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="using-and-converting-groups"><span class="header-section-number">18.3</span> Using and converting groups</h2>
<section id="converting-from-long-to-wide-data" class="level3">
<h3 class="anchored" data-anchor-id="converting-from-long-to-wide-data">Converting from long to wide data</h3>
<p>You’ve looked at different ways to think about data, but when we talk about “granular” data, “database” thinking or “tidy” data, we generally mean we’re working with what some people call “long” rather than “wide” data. That is, there are many rows but few columns.</p>
<p>But your instinct is to want to look at a rectangle of wide data, with the values of one column down the side and another across the top. Helpfully, a function called <code>pivot_wider()</code> does just that – pivots your data from long to wide.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Start with a simple query with two grouping columns (note that I’ve called the number of loans <code>loan_ct</code>, so it’s easier to work with later on.</p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["loan_status"],"name":[1],"type":["chr"],"align":["left"]},{"label":["draw"],"name":[2],"type":["chr"],"align":["left"]},{"label":["loan_ct"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Active Un-Disbursed","2":"First","3":"3"},{"1":"Exemption 4","2":"First","3":"13573"},{"1":"Exemption 4","2":"Second","3":"3898"},{"1":"Paid in Full","2":"First","3":"115139"},{"1":"Paid in Full","2":"Second","3":"36646"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<p>This is really hard to read. Turn it on its head with <code>pivot_wider()</code>:</p>
<p><img src="assets/images/r-groupby-pivotwider.png" class="img-fluid"></p>
<p>Normally, you’ll only want to have one summary statistic shown in a rectangle, with one column spread across the top and another column shown in rows. There are a lot of advanced options in pivot functions that let you show more than one statistic at a time, and tell R how to name them. There will be a chapter later on that addresses a lot of the problems you have in reading tables, so we’ll put that off for now.</p>
<p>Here’s an explanation of what the command looks like.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span> ( <span class="at">id_cols =</span>  column that you want to see as is down the side,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span>  column with the words you want to see across the top, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> column with the numbers you want <span class="cf">in</span> the middle</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>              ) </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your instinct will be to turn your data into one of these wider tables right from the start, but try to overcome it. The tidyverse expects to do most of its work in “long” format, saving the “wide” format just for printing.</p>
</div>
</div>
</section>
<section id="totals-and-subtotals" class="level3">
<h3 class="anchored" data-anchor-id="totals-and-subtotals">Totals and subtotals</h3>
<p>You noticed that when you created the summaries, there was no option to create a “percent of total” such as the percent of loans in each draw, or the percent of money that had been forgiven.</p>
<p>You can use summary functions outside a summarize statement!</p>
<p>This means that you can compute the percent of total, the same way you used an option in pivot tables. This took me a long time to understand, so try to slow down, and just try it a few times! When you look carefully at your output, you’ll start to understand it better.</p>
<p>The trick is to summarize, then use <code>mutate</code> to add a column with the percentages made out of totals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( draw) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">loan_count =</span> <span class="fu">n</span>() ) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">all_loans =</span> <span class="fu">sum</span> (loan_count), </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">pct_of_total =</span> loan_count <span class="sc">/</span> all_loans <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["draw"],"name":[1],"type":["chr"],"align":["left"]},{"label":["loan_count"],"name":[2],"type":["int"],"align":["right"]},{"label":["all_loans"],"name":[3],"type":["int"],"align":["right"]},{"label":["pct_of_total"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"First","2":"128715","3":"169259","4":"76.04618"},{"1":"Second","2":"40544","3":"169259","4":"23.95382"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<section id="what-happens-if-you-have-more-than-one-group" class="level4">
<h4 class="anchored" data-anchor-id="what-happens-if-you-have-more-than-one-group">What happens if you have more than one group?</h4>
<p>This is where the idea of grouped data gets a little confusing. It depends on exactly how you did your summarize statement. But if you use the default mechanism, the “all_loans” is the subtotal. The default behavior is that the “groups” are kept for all but the last column listed in the group_by statement, meaning any summaries you do off of the data will refer to the subtotal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( draw, loan_status) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">loan_count =</span> <span class="fu">n</span>() ) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">loans_in_draw =</span> <span class="fu">sum</span> (loan_count),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">pct_of_draw =</span> loan_count <span class="sc">/</span> loans_in_draw <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["draw"],"name":[1],"type":["chr"],"align":["left"]},{"label":["loan_status"],"name":[2],"type":["chr"],"align":["left"]},{"label":["loan_count"],"name":[3],"type":["int"],"align":["right"]},{"label":["loans_in_draw"],"name":[4],"type":["int"],"align":["right"]},{"label":["pct_of_draw"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"First","2":"Active Un-Disbursed","3":"3","4":"128715","5":"0.002330731"},{"1":"First","2":"Exemption 4","3":"13573","4":"128715","5":"10.545002525"},{"1":"First","2":"Paid in Full","3":"115139","4":"128715","5":"89.452666744"},{"1":"Second","2":"Exemption 4","3":"3898","4":"40544","5":"9.614246251"},{"1":"Second","2":"Paid in Full","3":"36646","4":"40544","5":"90.385753749"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Here’s a pretty typical way to do this: Create a subtotal, use it for your percentages, then pivot the percentages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( draw, loan_status) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="at">loan_count =</span> <span class="fu">n</span>() ) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">loans_in_draw =</span> <span class="fu">sum</span>(loan_count), </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">pct_of_draw =</span> loan_count <span class="sc">/</span> loans_in_draw <span class="sc">*</span> <span class="dv">100</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span> ( </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(draw, loans_in_draw), </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> loan_status, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> pct_of_draw,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'draw'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["draw"],"name":[1],"type":["chr"],"align":["left"]},{"label":["loans_in_draw"],"name":[2],"type":["int"],"align":["right"]},{"label":["Active Un-Disbursed"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Exemption 4"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Paid in Full"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"First","2":"128715","3":"0.002330731","4":"10.545003","5":"89.45267"},{"1":"Second","2":"40544","3":"0.000000000","4":"9.614246","5":"90.38575"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Now you can easily compare the outcome by draw, by reading across to reach 100% and reading down to compare them.</p>
<p>We’ll have a whole chapter / week on making good tables that are readable and understandable. For now, just remember that it’s always possible to turn a data frame on its head, and that you can compute much of what you need BEFORE you do that.</p>
</section>
</section>
</section>
<section id="practice" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="practice"><span class="header-section-number">18.4</span> Practice</h2>
<p>Putting together the grouping and summarizing, along with the commands you learned last chapter to <code>filter</code>, <code>arrange</code> and display the <code>head()</code> and <code>tail()</code> of a dataset should equip you to write the code for these questions:</p>
<ol type="1">
<li>Which lenders provided the most loans?</li>
<li>Which lenders provided the most amount of money loaned?</li>
<li>Which borrowers got the least amount of money?</li>
<li>Show the number of loans in each draw that went to the 24 (including <code>NA</code>) types of businesses. To see them all on one screen, add “, rows.print=25” to the heading of the code chunk like this: <code>{r  , rows.print=25}</code></li>
<li>Try to compute the percent of loans that went to projects in each county in Arizona. This will require first filtering, then grouping.</li>
</ol>
</section>
<section id="understanding-grouped-data" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="understanding-grouped-data"><span class="header-section-number">18.5</span> Postscript: Understanding grouped data</h2>
<p>You may have noticed an odd warning after you run the code with multiple grouping columns, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="in">`summarise()`</span> has grouped output by 'draw'. You can override using the <span class="in">`.groups`</span> argument." </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="what-does-that-mean" class="level4">
<h4 class="anchored" data-anchor-id="what-does-that-mean">What does that mean?</h4>
<p>When you grouped by loan status and draw, R effectively split up your data frame into five independent and completely divorced piles - one for each combination of draw and loan status that it found. It processed them one by one to create the output data frame that was printed out.</p>
<p>After it’s done summarizing your data, R doesn’t know what you want to do with the piles – keep them, or put everything back together again.</p>
<p>By default, after you group by more than one column, it maintains the separate piles for all but the last group in your list under <code>group_by</code> – in this case the <code>loan_status</code>. Here, everything you do after this will work on three piles separately.The message tells you what it did with the piles, and how to change that behavior.</p>
<p>The <a href="https://dplyr.tidyverse.org/articles/grouping.html">documentation of grouped data</a> provides details of how each of the tidyverse’s verbs handle grouped data.</p>
<p>Here’s what a “glimpse()” looks like for a data frame that has retained some groups:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> ( loan_status, date_approved<span class="sc">:</span>amount) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( loan_status) <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 169,259
Columns: 11
Groups: loan_status [3]
$ loan_status      &lt;chr&gt; "Paid in Full", "Paid in Full", "Paid in Full", "Paid…
$ date_approved    &lt;date&gt; 2020-04-10, 2020-04-11, 2020-04-11, 2020-04-29, 2020…
$ draw             &lt;chr&gt; "First", "First", "First", "First", "First", "First",…
$ borrower_name    &lt;chr&gt; "SFE HOLDINGS LLC", "NAVAJO TRIBAL UTILITY AUTHORITY"…
$ borrower_address &lt;chr&gt; "9366 East Raintree Drive", "Po Box 170", "2999 N44th…
$ borrower_city    &lt;chr&gt; "Scottsdale", "Fort Defiance", "Phoenix", "Tucson", "…
$ borrower_state   &lt;chr&gt; "AZ", "AZ", "AZ", "AZ", "AZ", "AZ", "AZ", "AZ", "AZ",…
$ borrower_zip     &lt;chr&gt; "85260", "86504", "85018", "85711", "85250", "85012",…
$ franchise_name   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ loan_status_date &lt;date&gt; 2021-08-17, 2022-02-05, 2021-09-25, 2021-08-21, 2021…
$ amount           &lt;dbl&gt; 10000000, 10000000, 10000000, 10000000, 10000000, 100…</code></pre>
</div>
</div>
<p>Notice the “Groups” row at the top – that tells you it’s got three piles, defined by the loan_status column.</p>
</section>
<section id="getting-rid-of-the-message" class="level4">
<h4 class="anchored" data-anchor-id="getting-rid-of-the-message">Getting rid of the message</h4>
<p>You can do two things to get rid of the message. I suggest the first of these, since it makes you explicitly decide what to do each time, depending on your goal:</p>
<ol type="1">
<li>Add a <code>.groups=...</code> argument that looks like this at the end of the <code>summarize</code> statement. This example tells R to do what it does by default, with no warning:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> ( loan_status, draw ) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span> ( <span class="st">`</span><span class="at"># of loans</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>() , </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop_last"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["loan_status"],"name":[1],"type":["chr"],"align":["left"]},{"label":["draw"],"name":[2],"type":["chr"],"align":["left"]},{"label":["# of loans"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Active Un-Disbursed","2":"First","3":"3"},{"1":"Exemption 4","2":"First","3":"13573"},{"1":"Exemption 4","2":"Second","3":"3898"},{"1":"Paid in Full","2":"First","3":"115139"},{"1":"Paid in Full","2":"Second","3":"36646"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The other possibilities are : <code>.groups="drop"</code> and <code>".groups="keep"</code> (Note the period before the word “groups”. I have no idea why, but sometimes options are indicated this way.)</p>
<ol start="2" type="1">
<li><p>Add a line to your setup chunk, changing the default behavior through the systemwide options:</p>
<p><code>options(dplyr.summarise.inform = FALSE)</code></p></li>
</ol>
</section>
<section id="what-does-tidy-data-have-to-do-with-groupings" class="level3">
<h3 class="anchored" data-anchor-id="what-does-tidy-data-have-to-do-with-groupings">What does “tidy” data have to do with groupings?</h3>
<p>Grouped data effectively breaks out values of categories and treats them independently, which is the equivalent of temporarily treating them as their own data frame.</p>
<p>It’s somewhat difficult in the tidyverse to summarize across columns – it really wants to summarize rows. In a spreadsheet, it’s just as easy to write an <code>=sum(B1:J1)</code> as it is <code>=sum(B1:B12)</code>. That’s not true in R journey so far. This is probably the first time your instinct would be to wreck a perfectly good dataset.</p>
<p>We’ll come back to all of that, but just remember that it’s possible to do all kinds of computations within a group that you’d normally think you want to do across columns. One example is, say, percent change over time. Instead of trying to compute them one by one, you can use groups and the lag() function to do math that depends on a previous row.</p>
<table class="table">
<thead>
<tr class="header">
<th>state</th>
<th>county</th>
<th>month</th>
<th>cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AL</td>
<td>Auburn</td>
<td>2020-04-01</td>
<td>24</td>
</tr>
<tr class="even">
<td>AL</td>
<td>Auburn</td>
<td>2020-05-01</td>
<td>35</td>
</tr>
<tr class="odd">
<td>AL</td>
<td>Auburn</td>
<td>2020-06-01</td>
<td>200</td>
</tr>
</tbody>
</table>
<pre><code>covid_data |&gt;
  group_by (state, county) |&gt; 
  arrange (month) |&gt; 
  mutate ( change = cases - lag(cases) , 
           pct_change = change / lag(cases) * 100 ) </code></pre>
<p>This method will start over for each county, so it will be <code>NA</code> for the first month within each county.</p>
<p>This is just one example of how grouped data is quite powerful when used correctly. There are many others, such as extracting the most recent event in a court history by case. Try to think about how one group would be computed, and then don’t worry how the rest will work – R will do that thinking for you.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Yes, there is something called <code>pivot_longer()</code>, which lets you turn rectangular data into the tidy form.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./r-groupby-story.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Summarizing detail into totals</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./r-verb-join.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Verbs in depth: Matchmaking with joins</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Data reporting for investigative journalism, Spring 2024, written by Sarah Cohen</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Produced with <a href="https://quarto.org">Quarto</a></div>
  </div>
</footer>



</body></html>