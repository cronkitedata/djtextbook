<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 24 Open refine walkthrough | Data Reporting, Spring 2022</title>
<meta name="author" content="Sarah Cohen">
<meta name="description" content="OpenRefine is a program designed to help you clean and standardize data. OpenRefine can be a little hard on your computer – it doesn’t handle large datasets very well, and it seems to work much...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content=" 24 Open refine walkthrough | Data Reporting, Spring 2022">
<meta property="og:type" content="book">
<meta property="og:url" content="https://github.com/cronkitedata/djtextbook/advanced-openrefine.html">
<meta property="og:description" content="OpenRefine is a program designed to help you clean and standardize data. OpenRefine can be a little hard on your computer – it doesn’t handle large datasets very well, and it seems to work much...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 24 Open refine walkthrough | Data Reporting, Spring 2022">
<meta name="twitter:site" content="@sarahcnyt">
<meta name="twitter:description" content="OpenRefine is a program designed to help you clean and standardize data. OpenRefine can be a little hard on your computer – it doesn’t handle large datasets very well, and it seems to work much...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Muli-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/core-js-2.5.3/shim.min.js"></script><script src="libs/react-17.0.0/react.min.js"></script><script src="libs/react-17.0.0/react-dom.min.js"></script><script src="libs/reactwidget-1.0.0/react-tools.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/reactable-binding-0.2.3/reactable.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link rel="shortcut icon" href="assets/images/favicon.ico">
<!--
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        --><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Reporting, Spring 2022</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Reporting with data</li>
<li><a class="" href="starter-intro.html">In this section</a></li>
<li><a class="" href="start-story.html"><span class="header-section-number">1</span> Learn a new way to read</a></li>
<li><a class="" href="start-math.html"><span class="header-section-number">2</span> Newsroom math</a></li>
<li><a class="" href="start-data-def.html"><span class="header-section-number">3</span> Defining “Data”</a></li>
<li><a class="" href="start-data-diary.html"><span class="header-section-number">4</span> Replication and the data diary</a></li>
<li><a class="" href="start-hunt.html"><span class="header-section-number">5</span> Finding the right data for your story</a></li>
<li><a class="" href="start-build-own.html"><span class="header-section-number">6</span> Build your own database</a></li>
<li class="book-part">Spreadsheets</li>
<li><a class="" href="xl-intro.html">Introduction</a></li>
<li><a class="" href="xl-refresher.html"><span class="header-section-number">7</span> An Excel Refresher</a></li>
<li><a class="" href="xl-filter-sort.html"><span class="header-section-number">8</span> Sorting and filtering to find stories</a></li>
<li><a class="" href="xl-pivot.html"><span class="header-section-number">9</span> Grouping with pivot tables</a></li>
<li><a class="" href="xl-formulas.html"><span class="header-section-number">10</span> Formulas in Excel</a></li>
<li><a class="" href="xl-practice-noc.html"><span class="header-section-number">11</span> Practice exercise</a></li>
<li class="book-part">R Study Guide</li>
<li><a class="" href="r-intro.html">Introduction</a></li>
<li><a class="" href="r-start.html"><span class="header-section-number">12</span> Getting started with R and RStudio</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">13</span> R Markdown</a></li>
<li><a class="" href="r-data-import.html"><span class="header-section-number">14</span> Getting and saving data</a></li>
<li><a class="" href="r-verbs.html"><span class="header-section-number">15</span> A quick tour of verbs</a></li>
<li><a class="" href="r-verb-filter.html"><span class="header-section-number">16</span> Verbs in depth: Select, filter, arrange</a></li>
<li><a class="" href="r-verb-groupby.html"><span class="header-section-number">17</span> Verbs in depth: Aggregating with groups</a></li>
<li><a class="" href="r-verb-mutate.html"><span class="header-section-number">18</span> Verbs in depth: New from old data with Mutate</a></li>
<li><a class="" href="r-verb-join.html"><span class="header-section-number">19</span> Verbs in depth: Matchmaking with joins</a></li>
<li><a class="" href="r-recipes.html"><span class="header-section-number">20</span> Recipes</a></li>
<li class="book-part">Visualization as a reporting tool</li>
<li><a class="" href="viz-intro.html">Introduction</a></li>
<li><a class="" href="viz-reporting.html"><span class="header-section-number">21</span> Visualization as a reporting tool</a></li>
<li><a class="" href="viz-demo.html"><span class="header-section-number">22</span> Visualization demo</a></li>
<li class="book-part">Special skills</li>
<li><a class="" href="advanced-intro.html">Introduction</a></li>
<li><a class="" href="advanced-regex.html"><span class="header-section-number">23</span> Regular Expressions for pattern matching</a></li>
<li><a class="active" href="advanced-openrefine.html"><span class="header-section-number">24</span> Open refine walkthrough</a></li>
<li><a class="" href="advanced-scrape1.html"><span class="header-section-number">25</span> Scraping without programming</a></li>
<li><a class="" href="advanced-scrape2.html"><span class="header-section-number">26</span> Introduction to scraping in R</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendix-math.html"><span class="header-section-number">A</span> Newsroom numbers cheat sheet</a></li>
<li><a class="" href="appendix-program.html"><span class="header-section-number">B</span> A gentle intro to programming</a></li>
<li><a class="" href="appendix-glossary.html"><span class="header-section-number">C</span> Glossary</a></li>
<li><a class="" href="appendix-resources.html"><span class="header-section-number">D</span> Great R Resources</a></li>
<li><a class="" href="appendix-ppp.html"><span class="header-section-number">E</span> Documentation for PPP data chapters</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="advanced-openrefine" class="section level1" number="24">
<h1>
<span class="header-section-number"> 24</span> Open refine walkthrough<a class="anchor" aria-label="anchor" href="#advanced-openrefine"><i class="fas fa-link"></i></a>
</h1>
<p>OpenRefine is a program designed to help you clean and standardize data. OpenRefine can be a little hard on your computer – it doesn’t handle large datasets very well, and it seems to work much better in Chrome than in other browsers.</p>
<p>This walkthrough goes through some of the PPP data to a) clean up the city names, b) standardize the borrower names, and c) split the suite or other detailed address from the street addresses.</p>
<div class="alert alert-info">
<p>Right-click to <a href="https://cronkitedata.s3.amazonaws.com/csv/ppp_az_openrefine_input.csv">download the data</a> for this walkthrough and save it into your projects folder</p>
</div>
<div id="installing-openrefine" class="section level2" number="24.1">
<h2>
<span class="header-section-number">24.1</span> Installing OpenRefine<a class="anchor" aria-label="anchor" href="#installing-openrefine"><i class="fas fa-link"></i></a>
</h2>
<p>Download the latest version from the <a href="https://openrefine.org/download.html">OpenRefine website</a> and follow the instructions there to install.</p>
<div id="mac-users-unidentified-developer" class="section level3 unnumbered">
<h3>Mac users: Unidentified developer<a class="anchor" aria-label="anchor" href="#mac-users-unidentified-developer"><i class="fas fa-link"></i></a>
</h3>
<p>For Mac users, when you try to open it, it may tell you that you can’t because it’s from an unidentified developer. Go to the Applications folder on your computer, and use the CTL button before you click on the OpenRefine diamond. Once you successfully open it once, the program is whitelisted on your computer and you shouldn’t have to do it again.</p>
</div>
<div id="windows-users" class="section level3 unnumbered">
<h3>Windows users<a class="anchor" aria-label="anchor" href="#windows-users"><i class="fas fa-link"></i></a>
</h3>
<p>Windows users should take the “Windows kit with embedded Java” rather than trying to install the right version of Java yourself. You may have to go through the Windows Defender settings to set up an exclusion that allows Windows to run it, or get your system administrator to allow you to use it. You should only have to set this up once.</p>
</div>
<div id="limitations" class="section level3 unnumbered">
<h3>Limitations<a class="anchor" aria-label="anchor" href="#limitations"><i class="fas fa-link"></i></a>
</h3>
<p>OpenRefine works entirely in memory, and will start choking pretty quickly once you reach the 100,000 to 200,000 row range. You might need to partition your data or pull out just the columns you want to work on in order to clean a large dataset.</p>
</div>
<div id="following-the-walkthrough" class="section level3 unnumbered">
<h3>Following the walkthrough<a class="anchor" aria-label="anchor" href="#following-the-walkthrough"><i class="fas fa-link"></i></a>
</h3>
<p>Steps that you should take are shown in bullet points. The rest is explanation.</p>
</div>
</div>
<div id="starting-openrefine" class="section level2" number="24.2">
<h2>
<span class="header-section-number">24.2</span> Starting OpenRefine<a class="anchor" aria-label="anchor" href="#starting-openrefine"><i class="fas fa-link"></i></a>
</h2>
<p>OpenRefine is a Java-based program that runs inside your browser, but lives on your computer instead of the internet. It runs much better in Chrome than in Safari.</p>
<ul>
<li><p>Find the OpenRefine app on your computer, and double-click. When you first start it up, it will open with your default browser.</p></li>
<li><p>If it’s not Chrome, open a Chrome window and type the local address into its address bar: <code class="sourceCode haskell">localhost<span class="op">:</span><span class="dv">3333</span></code> or <code>127.0.0.1:3333</code></p></li>
</ul>
<p>Once it’s open in your browser, you’ll see something that looks like this:</p>
<div class="figure">
<img src="assets/images/advanced-openrefine-create.png" style="width:75.0%" alt=""><p class="caption">first screen</p>
</div>
</div>
<div id="importing-data" class="section level2" number="24.3">
<h2>
<span class="header-section-number">24.3</span> Importing data<a class="anchor" aria-label="anchor" href="#importing-data"><i class="fas fa-link"></i></a>
</h2>
<p>OpenRefine works best on comma- or tab-delimited data. To create a dataset like that from R, use the function <code>write_csv("path-to-csv-file.csv")</code> , which can be used like any other verb after a continuation pipe.</p>
<ul>
<li><p>To follow along with this tutorial, <a href="https://cronkitedata.s3.amazonaws.com/csv/ppp_az_openrefine_input.csv">download the sample data file</a> and save it into your R project folder .</p></li>
<li><p>In OpenRefine, look on the left of the screen and choose <em>Create Project-&gt;Choose files</em>, and navigate to the folder where you saved it. Choose the file you just saved, and consider changing the name of the project to something other than the file name. I called mine “ppp refined”.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Note: It lives in a different place than your folder on your computer. It’s actually a little hard to find, but you shouldn’t have to unless you’re moving between computers. You can always export all of the steps so that you can do them over on a new computer.&lt;/p&gt;"><sup>26</sup></a></p></li>
</ul>
<div class="figure">
<img src="assets/images/advanced-openrefine-firstscreen.png" alt=""><p class="caption">import screen</p>
</div>
<p>Usually, the default selections at the bottom work. They’re pretty self-explanatory, but if your data looks weird when it is imported, take a look for some options here.</p>
<p>I usually keep everything as “text” because OpenRefine doesn’t work as well with dates as numbers as it does with text. In this case, I’ve removed the amounts and dates from the data that we’re working with.</p>
<ul>
<li>Click the “Create Project” button to continue.</li>
</ul>
<div id="returning-to-your-project" class="section level3 unnumbered">
<h3>Returning to your project<a class="anchor" aria-label="anchor" href="#returning-to-your-project"><i class="fas fa-link"></i></a>
</h3>
<p>You can also use that startup screen to re-open a project you’ve previously worked on. You don’t need to save it – OpenRefine saves it for you in the background. Use the Open tab to find your projects. If you need to move your project to another computer, you can use the <a href="https://docs.openrefine.org/manual/exporting#export-a-project">Export options</a> once it’s open.</p>
</div>
<div id="rename-or-copy-columns" class="section level3 unnumbered">
<h3>Rename or copy columns<a class="anchor" aria-label="anchor" href="#rename-or-copy-columns"><i class="fas fa-link"></i></a>
</h3>
<p>Eventually, you’ll want to re-import the results of your cleaning to your R or other programming environment, and it will cause you no end of trouble if you can’t match it up with the original data, or if columns have the same names.</p>
<div class="alert alert-warning">
<p>Before you do any work on a column, be sure to either rename it or copy it into a new column. Someday you’ll thank me for this.</p>
</div>
<p>To rename something that is relatively simple to clean, such as the <code>project_county</code> in the PPP data, use the dropdown menu, and choose <em>Edit column-&gt;Rename this column</em> . I usually call it whatever the column name started as with a suffix <code>_refined</code>.</p>
<ul>
<li>Rename the columns <code>project_county</code> and <code>project_state</code> now.</li>
</ul>
<p>To make a copy, use the dropdown menu <em>Edit column-&gt;Add column based on this column</em> and give it a name.</p>
</div>
</div>
<div id="facets" class="section level2" number="24.4">
<h2>
<span class="header-section-number">24.4</span> Facets<a class="anchor" aria-label="anchor" href="#facets"><i class="fas fa-link"></i></a>
</h2>
<p>For many text columns, you can use facets to edit your data. Under your newly named <code>project_state_refined</code>, choose <em>Facet-&gt;Text facet</em> to get a menu on the left. It will then show you the values it found in that column, and the number of times each one appears, much like at <code>group_by</code> query.</p>
<p>OpenRefine only acts on rows that are selected, which makes using facets and filtering so powerful. You never have to worry that you’re changing something that you don’t see.</p>
<div class="figure">
<img src="assets/images/advanced-openrefine-facet.png" style="width:50.0%" alt=""><p class="caption">facet</p>
</div>
<ul>
<li>To edit one by one, click on the state name you want to change, and choose the <em>Edit</em> option. You might combine all of the other states into an “OTHER” state.</li>
</ul>
<p>A faster way to change everything that is selected at once is through the column’s menu.</p>
<ul>
<li><p>Select “AZ” from the facet list, then choose <em>invert</em> from the top of the box to select everything except AZ.</p></li>
<li><p>Under the column dropdown, choose <em>Facet-&gt;Edit Cells-&gt;Transform</em>, and type “OTHER” (with the quotes) into the value box. (If you forget the quotes, you’ll see it come up with Null as an answer because it’s looking for a variable called <code>other</code>, not the word “other”)</p></li>
<li><p>With the same selection on, change the county name to “OUT OF STATE” using the same method.</p></li>
</ul>
</div>
<div id="clustering" class="section level2" number="24.5">
<h2>
<span class="header-section-number">24.5</span> Clustering<a class="anchor" aria-label="anchor" href="#clustering"><i class="fas fa-link"></i></a>
</h2>
<p>One reason a lot of reporters use OpenRefine is to take advantage of its fuzzy-matching to clean items like names and addresses. It provides about a dozen different algorithms that provide suggestions on ways to change unstandardized values in a column that often make a lot of sense.</p>
<p>This walkthrough will work on the city name.</p>
<div class="alert alert-warning">
<p>Make a copy of the city and call it borrower_city_refined by using the dropdown <em>Edit column-&gt;Add column based on this column</em> . Otherwise you risk over-writing things incorrectly, and you’ll have to try to figure out where you went wrong.</p>
</div>
<div class="figure">
<img src="assets/images/advanced-openrefine-addcolumn.png" style="width:100.0%" alt=""><p class="caption">add column</p>
</div>
<ul>
<li>Now create a facet on this new column.</li>
</ul>
<p>You should see all of the bad values that were entered into that column by lenders and applicants. No one cared whether it was a valid city name.</p>
<div id="clustering-details" class="section level3 unnumbered">
<h3>Clustering details<a class="anchor" aria-label="anchor" href="#clustering-details"><i class="fas fa-link"></i></a>
</h3>
<p>You’ll often use many of the clustering approaches, then finish up with some other filters and facets when the clustering doesn’t work.</p>
<p>Some algorithms work better than others – some don’t catch natural clusters, and others find a lot of things to cluster that shouldn’t be combined. It’s unimportant for us what they actually do behind the scenes. Insetad, just know that they are different methods to find near-exact matches among character values.</p>
<p>One might look for all words that have the same letters but in any order, another might look for everything that matches the shortest phrase, and another might look for any 2 words in common. The order suggested by OpenRefine generally goes from the most strict to the most forgiving method, and from the easiest on your computer to the most resource-intensive. <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;There is something called “reconciliation” in OpenRefine that tries to find matches in OpenCorporates lists of companies, or in a list that you provide. We’re not getting into that.&lt;/p&gt;"><sup>27</sup></a></p>
<ul>
<li><p>On the facet, press the button that says “Cluster”. The first one chosen, called “key collision” by “fingerprint”, doesn’t come up with any suggestions.</p></li>
<li><p>Use the dropdown menu in the Keying Function box to choose the next option, “ngram-fingerprint”, and leave the option at 2.</p></li>
</ul>
<div class="figure">
<img src="assets/images/advanced-openrefine-cluster.png" style="width:100.0%" alt=""><p class="caption">cluster</p>
</div>
<p>Now you can see how close some of the choices are.</p>
<ul>
<li><p>Look through your choices, and select any that you want to combine. OpenRefine will change the least popular entry to the most popular, but you can change what you want it to be in the box provided. (At first, you’ll probably “Select all” and then just un-select the bad ones.)</p></li>
<li><p>Keep going with other clustering methods, turning off the ones you’re not sure should be combined and editing the value you want it to be. After exploring all of the options, I often end by going back to the ngram-fingerprint method and changing it to Ngram size of 1. That often catches the last remnants of one-word cities.</p></li>
</ul>
<div class="figure">
<img src="assets/images/advanced-openrefine-cluster2.png" style="width:100.0%" alt=""><p class="caption">ngram</p>
</div>
<ul>
<li>Spend about 10-15 minutes cleaning up the cities, and see how close you can get to a good list.</li>
</ul>
<div class="alert alert-info">
<p>Pro tip: Don’t try to do everything through clustering. You can’t really fine-tune the choices, so just stop when it’s getting close. You can then do the remaining things you care about manually. Try not to get too obsessed with getting it perfect. You’ll spend days on things that won’t matter, especially in early stages of your reporting when you don’t know what you care about.</p>
</div>
</div>
<div id="facet-for-long-entries" class="section level3 unnumbered">
<h3>Facet for long entries<a class="anchor" aria-label="anchor" href="#facet-for-long-entries"><i class="fas fa-link"></i></a>
</h3>
<p>In this list, though, there are addresses that are listed as cities. We may just want to remove those city names entirely, since we don’t really know what they are. There are several ways you might do this:</p>
<ul>
<li>Use the <em>Facet-&gt;Customized facets-&gt;Text length facet</em> menu item to create a facet by string length. Use the scrollbar to choose, say, more than 20 or 25 characters.</li>
<li>Go through the list and select the ones that should <em>not</em> be changed, then</li>
<li>Invert the selection and use the Transform menu to change the city to “Unknown”.</li>
</ul>
<p>That got rid of most of them. You can go back to the original facet and select the ones at the top and change them as well.</p>
<p>The list isn’t perfect, but it’s much better than what we started with.</p>
</div>
</div>
<div id="filtering-2" class="section level2" number="24.6">
<h2>
<span class="header-section-number">24.6</span> Filtering<a class="anchor" aria-label="anchor" href="#filtering-2"><i class="fas fa-link"></i></a>
</h2>
<p>Even after fixing all of the cities we can through clustering and faceting, there are usually some bad entries left over.</p>
<div id="simple-filter" class="section level3" number="24.6.1">
<h3>
<span class="header-section-number">24.6.1</span> Simple filter<a class="anchor" aria-label="anchor" href="#simple-filter"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Instead of a Text Facet, choose <em>Text filter</em> from the dropdown menu. Generally, I use regular expressions in this box so I can control where in the column my target word or letters falls.</p></li>
<li><p>Try filtering for <code>^Phoe</code> after checking the “regular expression” box, and you’ll see a few stray entries for Phoenix that you can change in the facet window.</p></li>
</ul>
<p>I tend to do this for anything I really care about getting right, such as larger cities or towns that I am going to report on. It’s often not worth the time to get a large list 100% accurate.</p>
</div>
<div id="complex-filter" class="section level3 unnumbered">
<h3>Complex filter<a class="anchor" aria-label="anchor" href="#complex-filter"><i class="fas fa-link"></i></a>
</h3>
<p>A complex filter will help you tag items for later use. One example is to tag items that contain apartment numbers, suite numbers or floor numbers after the address. Eventually, we may want to split the address column in two – one piece for the street address, and one piece for the detailed location.</p>
<p>Filtering for them first ensures that you won’t inadvertently split something that hasn’t met your condition in the first place.</p>
<p>Regular expressions work here the same way they did in <code>str_detect</code> in R, except that there is one backslash rather than two for special characters.</p>
<ul>
<li>Here is an example of how to find anything that has the word Suite or Ste after at least 10 other characters: <code>.{10,}\bS(ui)?te\b</code>
</li>
</ul>
<div class="figure">
<img src="assets/images/advanced-openrefine-regex-filter.png" style="width:100.0%" alt=""><p class="caption">example regex</p>
</div>
<p>Using these filters, we can start splitting the values into their pieces.</p>
</div>
<div id="split-by-regex" class="section level3 unnumbered">
<h3>Split by regex<a class="anchor" aria-label="anchor" href="#split-by-regex"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Choose <em>Edit column-&gt;Split into several columns…</em> from the dropdown menu, then use the regular expression as the “split” character. Make sure to un-check the “Guess cell type” and “Remove this column” boxes.</li>
</ul>
<p>You can go back and look for entries that have “floor” or “apt” the same way, and split them in subsequent steps.</p>
</div>
<div id="split-using-openrefine-programming-language" class="section level3 unnumbered">
<h3>Split using OpenRefine programming language<a class="anchor" aria-label="anchor" href="#split-using-openrefine-programming-language"><i class="fas fa-link"></i></a>
</h3>
<p>That took care of the ones that had Suite numbers in them. Now we have to get the ones that have Apartment numbers in them. Use a regular expression to filter for the apartment numbers, and a <em>Customized Facet-&gt;Facet by null</em> to pick out the ones that haven’t already been split by our previous step.</p>
<p>OpenRefine has its own special language called GREL, which is really hard to use. But we’ll have to use it for this set because we’ve already split something else. This time, we have to put a value in the two columns based on pieces of a regular expression.</p>
<ul>
<li>With your filter on, choose <code>borrower_address_refined_2</code>’s Transform menu. I’ll just show you how to do this, since it’s hard to explain:</li>
</ul>
<p>-In the “Expression” box, copy and paste this code:</p>
<p><code>cells["borrower_address_refined"].value.match(/(.+)?\b(Apt .*)\b$/)[1]</code></p>
<p>This tells OpenRefine to extract two pieces from the original address column: The beginning (.+)?, the word “Apt” followed by anything at the end. The [1] tells OpenRefine to take the 2nd of those (its counting starts at zero, not one) and put it in the same column that we used for the Suite numbers. (NOTE: The GREL regular expressions are indicated by the two slashes at the beginning and end of the phrase (<code>/</code>). This is typical for regular expressions, and it distinguishes them from plain text.)</p>
<ul>
<li>Repeat the process, in the <code>borrower_address_refined_1</code> column’s transformation, and use the index [0] at the end to get the cleaned street address.</li>
</ul>
</div>
</div>
<div id="finishing-up" class="section level2" number="24.7">
<h2>
<span class="header-section-number">24.7</span> Finishing up<a class="anchor" aria-label="anchor" href="#finishing-up"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Try using the clustering and other transformation options to clean up the borrower names. Only change the ones you are sure should be combined.</li>
</ul>
<p>Once you’re done, export the project to a new .csv file, and then import it into R. You can then select the cleaned up columns and the <code>loan_id</code> , then join it back to the original PPP data frame. Now you have a good set of cities, better ways to look at popular addresses, etc.</p>
<p>If you want to try another exercise, <a href="https://github.com/sarahcnyt/data-journalism/tree/master/openrefine">here is an old workshop I did for IRE in 2016</a>.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="advanced-regex.html"><span class="header-section-number">23</span> Regular Expressions for pattern matching</a></div>
<div class="next"><a href="advanced-scrape1.html"><span class="header-section-number">25</span> Scraping without programming</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#advanced-openrefine"><span class="header-section-number">24</span> Open refine walkthrough</a></li>
<li>
<a class="nav-link" href="#installing-openrefine"><span class="header-section-number">24.1</span> Installing OpenRefine</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#mac-users-unidentified-developer">Mac users: Unidentified developer</a></li>
<li><a class="nav-link" href="#windows-users">Windows users</a></li>
<li><a class="nav-link" href="#limitations">Limitations</a></li>
<li><a class="nav-link" href="#following-the-walkthrough">Following the walkthrough</a></li>
</ul>
</li>
<li><a class="nav-link" href="#starting-openrefine"><span class="header-section-number">24.2</span> Starting OpenRefine</a></li>
<li>
<a class="nav-link" href="#importing-data"><span class="header-section-number">24.3</span> Importing data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#returning-to-your-project">Returning to your project</a></li>
<li><a class="nav-link" href="#rename-or-copy-columns">Rename or copy columns</a></li>
</ul>
</li>
<li><a class="nav-link" href="#facets"><span class="header-section-number">24.4</span> Facets</a></li>
<li>
<a class="nav-link" href="#clustering"><span class="header-section-number">24.5</span> Clustering</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#clustering-details">Clustering details</a></li>
<li><a class="nav-link" href="#facet-for-long-entries">Facet for long entries</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filtering-2"><span class="header-section-number">24.6</span> Filtering</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-filter"><span class="header-section-number">24.6.1</span> Simple filter</a></li>
<li><a class="nav-link" href="#complex-filter">Complex filter</a></li>
<li><a class="nav-link" href="#split-by-regex">Split by regex</a></li>
<li><a class="nav-link" href="#split-using-openrefine-programming-language">Split using OpenRefine programming language</a></li>
</ul>
</li>
<li><a class="nav-link" href="#finishing-up"><span class="header-section-number">24.7</span> Finishing up</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Reporting, Spring 2022</strong>" was written by Sarah Cohen. It was last built on 2022-03-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
