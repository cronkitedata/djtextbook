<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.537">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Reporting - 16&nbsp; Verbs in depth: New from old data with Mutate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./r-groupby-story.html" rel="next">
<link href="./r-verb-filter.html" rel="prev">
<link href="./assets/images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="site_libs/react-18.2.0/react.min.js"></script>
<script src="site_libs/react-18.2.0/react-dom.min.js"></script>
<script src="site_libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="site_libs/reactable-binding-0.4.4/reactable.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rdepth.html">Verbs of the tidyverse</a></li><li class="breadcrumb-item"><a href="./r-verb-mutate.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Verbs in depth: New from old data with Mutate</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/images/favicon.ico" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Reporting</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/cronkitedata/djtextbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reporting with data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Learn a new way to read</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Newsroom math</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-data-def.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Defining "Data"</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-data-document.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Documenting your work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-hunt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Finding the right data for your story</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-build-own.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Build your own database</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming quick start</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">A gentle intro to programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-startup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Getting started with R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Getting and saving data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quickstart-verbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">A quick tour of verbs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rdepth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Verbs of the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Tidy data principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-filter-sort-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Sorting and filtering to find stories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Verbs in depth: Select, arrange, filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-mutate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Verbs in depth: New from old data with Mutate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-groupby-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Summarizing detail into totals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-groupby.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verbs in depth: Aggregating with groups</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-groupby-skittles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Aggregating with Skittles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-verb-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Verbs in depth: Matchmaking with joins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Recipes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Newsroom numbers cheat sheet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-filetypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">File types in the wild</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-ppp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Documentation for PPP data chapters</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter:</h2>
   
  <ul>
  <li><a href="#mutate-to-create-new-columns" id="toc-mutate-to-create-new-columns" class="nav-link active" data-scroll-target="#mutate-to-create-new-columns"><span class="header-section-number">16.1</span> <code>mutate</code> to create new columns</a></li>
  <li><a href="#math-on-columns" id="toc-math-on-columns" class="nav-link" data-scroll-target="#math-on-columns"><span class="header-section-number">16.2</span> Math on columns</a>
  <ul class="collapse">
  <li><a href="#converting-na-to-0" id="toc-converting-na-to-0" class="nav-link" data-scroll-target="#converting-na-to-0">Converting NA to 0</a></li>
  <li><a href="#detail-and-total-with-summary-statistics" id="toc-detail-and-total-with-summary-statistics" class="nav-link" data-scroll-target="#detail-and-total-with-summary-statistics">Detail and total with summary statistics</a></li>
  </ul></li>
  <li><a href="#creating-categories-for-easier-analysis" id="toc-creating-categories-for-easier-analysis" class="nav-link" data-scroll-target="#creating-categories-for-easier-analysis"><span class="header-section-number">16.3</span> Creating categories for easier analysis</a>
  <ul class="collapse">
  <li><a href="#yes-no-categories-using-if_else" id="toc-yes-no-categories-using-if_else" class="nav-link" data-scroll-target="#yes-no-categories-using-if_else">Yes-No categories using <code>if_else()</code></a></li>
  <li><a href="#more-than-two-categories-using-case_when" id="toc-more-than-two-categories-using-case_when" class="nav-link" data-scroll-target="#more-than-two-categories-using-case_when">More than two categories using <code>case_when()</code></a></li>
  </ul></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">16.4</span> Putting it all together</a>
  <ul class="collapse">
  <li><a href="#save-it-for-use-in-another-program" id="toc-save-it-for-use-in-another-program" class="nav-link" data-scroll-target="#save-it-for-use-in-another-program">Save it for use in another program</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rdepth.html">Verbs of the tidyverse</a></li><li class="breadcrumb-item"><a href="./r-verb-mutate.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Verbs in depth: New from old data with Mutate</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="r-verb-mutate" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Verbs in depth: New from old data with Mutate</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<p>This continues the work using Arizona Paycheck Protection Program loans. Full documentation of the dataset is in the <a href="appendix-ppp.html">Appendix</a>.</p>
<div class="callout-dothis">
<p>To follow along, open your PPP project and create a new Quarto document with <a href="https://gist.github.com/sarahcnyt/e60ad2d7ccf65498fc88791f3bb683ae">the usual front matter and setup chunk</a>.</p>
<p>Load the data into your environment using this code chunk:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="ot">&lt;-</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>( </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">url</span> ( </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     <span class="st">"https://cronkitedata.s3.amazonaws.com/rdata/ppp_az_loans.RDS"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mutate-to-create-new-columns" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="mutate-to-create-new-columns"><span class="header-section-number">16.1</span> <code>mutate</code> to create new columns</h2>
<p>Use the verb <code>mutate</code> whenever you want to create or change existing columns in your data.</p>
<p>Examples of this include:</p>
<ul>
<li>Computing difference between numbers in two columns</li>
<li>Replacing <code>NA</code> values with “Unknown” or zero.</li>
<li>Collapsing or creating categories for more meaningful analysis</li>
</ul>
<p>You will often use a combination of filtering and mutating to create a new data frame using the <code>&lt;-</code> assignment to use in future code chunks. That’s because they can get complex, and you don’t want to repeat code that you might have to change over and over.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This chapter assumes you have gone through the <a href="./r-verb-filter.html">filtering</a> chapter. Many of the expressions and functions are the same, so if they don’t look familiar to you, consider reviewing that chapter (again) first.</p>
</div>
</div>
<p><code>mutate</code> uses the syntax:</p>
<pre><code>    mutate ( new_column_name = function (arguments))</code></pre>
<p>That’s pretty abstract, so we’ll do this using examples.</p>
</section>
<section id="math-on-columns" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="math-on-columns"><span class="header-section-number">16.2</span> Math on columns</h2>
<p>Here’s an example of computing the portion of the original amount that was forgiven.</p>
<p>Use the single “=” sign to provide a name for the new column and create more than one new column using a comma between them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>ppp_orig <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span> ( borrower_name, borrower_city, amount, forgiveness_amount) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> ( <span class="at">forgiven_pct =</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>               ( forgiveness_amount  <span class="sc">/</span>  amount )  <span class="sc">*</span> <span class="dv">100</span></span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>            )   <span class="sc">|&gt;</span>                   </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-6" class="code-annotation-target"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span> (<span class="dv">50</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1">Pick out a few columns to work with</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="2">Compute a new column using math</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="6" data-code-annotation="3">Print out a random sample of 50 rows</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A value over 100 means that the government also waived fees and interest; a value under 100 means that less than all of the loan was forgiven.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-20255e85ba2505972a00" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-20255e85ba2505972a00">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"borrower_name":["POKE ME PRETTY LLC","CANDANCE BAINES","HANDLEBARJ INC","FIRM INC","GARRETT JACOBSON","PREMIER SOLAR SOLUTION LLC","MARY V ACOSTA","HYPO2 MASSAGE LLC","TITAN ADVISORS LLC","DJS RV RESORT LLC","SUNNAS KOREAN RESTAURANT","THE PRODUCTION CHOICE LLC","DESERT DREAM CUSTOMS LLC","OWMI LLC","ONE SPECIAL PLACE LLC","CAROLYN NORRIS","TAKE NOTE LLC","RALPH RAZO","JOSHUA CARDEN LAW FIRM PC","KJS CONVENIENT STOP LLC","ADAN ALARCON PACHECO","ALEX PATTON","JACKLINE KNIGHT","FIESTA BURRITO MEXICAN FOOD INC","CLOYS AUTO PAINT REPAIR LLC","SHERRYS PAMPERED PETS LLC","DAVID P HERBERT DDS PLLC","BLINDS DESIGNS","CARLA S MANNES MSWCGF COUNSELING SERVICES LLC","GPE CONSTRUCTION LLC","STRAIGHTLINE LANDSCAPE INC","VICKIE BAKER","WAYNEMAN J WARD","EDUCATIONAL CONTRACTING LLC","SCOOTERS FAMILY FUN CENTER LLC","RELIANCE MEDICAL PLLC","MICHAEL L SMITH PLLC","AFFORDABLE PEST CONTROL LLC","THOMAS RODEN","TEMPE DENTAL CENTER LLC","COMPTON PLUMBING SERVICES LLC","MICHAEL HETH","CORINNE CRUZ","AARON BYRDSONG","MCINTYRE ENVIRONMENTAL LLC","S FRAGOZA TRUCKING LLC","JESUS REYES","KLEINS UPHOLSTERY","JONATHAN JOHNSON","EMERGENCY CLEANUP SERVICES LLC"],"borrower_city":["Peoria","Phoenix","Scottsdale","Yuma","Gilbert","Phoenix","Yuma","Flagstaff","Scottsdale","Lake Havasu City","Sierra Vista","Mesa","Phoenix","Ajo","Phoenix","Tucson","Phoenix","Phoenix","Scottsdale","Tucson","Goodyear","Tucson","Phoenix","Scottsdale","Surprise","Phoenix","Prescott","Payson","Mesa","Phoenix","Phoenix","Maricopa","Peoria","Mesa","Bullhead City","Avondale","Paradise Valley","San Tan Valley","Gilbert","Tempe","Mesa","Sun Lakes","Phoenix","Tempe","Tucson","Amado","Laveen","Cave Creek","Tucson","Gilbert"],"amount":[5833,20832,212222,518845,20832,223724,7559,9500,17700,10098,17307,1332700,28750,4100,75000,10386,10915,15000,23155,35317,12632,20833,6783,83726.5,10355,31800,69172,14316,4900,35847,112500,20833,20625,7268,25000,10029,4375,50000,19973,15100,409927,4782.5,7082,20832,7500,15726,20833.33,8862,20832,176322],"forgiveness_amount":[5900.92,20921.11,214093.8,526435.77,20888.13,226383.83,7651.78,9588.23,17866.18,10227.75,17441.19,1341399.57,29179.67,4141.9,75787.5,10505.79,11008,15030,23301.87,35487.3,12680.42,20901.49,6808.27,84654.47,10413.35,32104.06,69524.49,14503.48,4945.87,36025.24,113212.5,20885.51,"NA",7342.07,25232.07,10183.14,4423.95,43252.84,20172.73,"NA",414279.06,3795.35,7160.3,"NA",7551.88,15781.04,20939.23,8931.68,"NA","NA"],"forgiven_pct":[1.01164409394823,1.00427755376344,1.00882000923561,1.01463013038576,1.0026944124424,1.01188888988218,1.01227411033205,1.00928736842105,1.00938870056497,1.01284907902555,1.00775351014041,1.00652777819464,1.01494504347826,1.01021951219512,1.0105,1.01153379549393,1.00852038479157,1.002,1.00634290649968,1.00482204037716,1.00383312222926,1.00328757260116,1.00372549019608,1.01108334876055,1.00563495895703,1.00956163522013,1.005095848031,1.01309583682593,1.0093612244898,1.00497224314447,1.00633333333333,1.00252052032833,"NA",1.01019124931205,1.0092828,1.0153694286569,1.01118857142857,0.8650568,1.01,"NA",1.01061667077309,0.793591217982227,1.01105619881389,"NA",1.00691733333333,1.00349993641104,1.00508320081331,1.0078627849244,"NA","NA"]},"columns":[{"id":"borrower_name","name":"borrower_name","type":"character","format":{"cell":{"digits":0,"separators":true,"currency":"USD"},"aggregated":{"digits":0,"separators":true,"currency":"USD"}},"na":"NA"},{"id":"borrower_city","name":"borrower_city","type":"character","format":{"cell":{"digits":0,"separators":true,"currency":"USD"},"aggregated":{"digits":0,"separators":true,"currency":"USD"}},"na":"NA"},{"id":"amount","name":"amount","type":"numeric","format":{"cell":{"digits":0,"separators":true,"currency":"USD"},"aggregated":{"digits":0,"separators":true,"currency":"USD"}},"na":"NA"},{"id":"forgiveness_amount","name":"forgiveness_amount","type":"numeric","format":{"cell":{"digits":0,"separators":true,"currency":"USD"},"aggregated":{"digits":0,"separators":true,"currency":"USD"}},"na":"NA"},{"id":"forgiven_pct","name":"forgiven_pct","type":"numeric","format":{"cell":{"digits":1,"percent":true},"aggregated":{"digits":1,"percent":true}},"na":"NA"}],"defaultPageSize":5,"dataKey":"ad396561916eacad60bc5893a8b78786"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>(I did some fancy formatting so you could read the results more clearly. We’ll come back to that in a later lesson.)</p>
<section id="converting-na-to-0" class="level3">
<h3 class="anchored" data-anchor-id="converting-na-to-0">Converting NA to 0</h3>
<p>If you look through the pages, you’ll realize that there are a lot of rows with <code>NA</code> instead of a value. That’s because whenever you do anything with a missing value, the result is missing. Missing values infect everything they touch. You often have to deal with them before you can do anything else.</p>
<p>We would like to convert the forgiven amount from a missing value to zero, under the idea that if they have not filled it out, nothing has (yet) been forgiven. Of course, we’d have to check that with the SBA before publication.</p>
<p>There is a specific function used for that: <code>replace_na()</code>, with two arguments: The column you want to check for missing values, and the value you want to use instead. This isn’t limited to numbers – you can do the same thing with words, often replacing NA with “Unknown”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ppp_forgiven_fixed <span class="ot">&lt;-</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  ppp_orig <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">amount_forgiven =</span> <span class="fu">replace_na</span>(forgiveness_amount, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Note that nothing came out in this code chunk because the result was saved into a new data frame)</p>
</section>
<section id="detail-and-total-with-summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="detail-and-total-with-summary-statistics">Detail and total with summary statistics</h3>
<p>You can use <code>mutate</code> to put summary statistics next to your values so you can see whether or not they are similar to the average or median.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ppp_forgiven_fixed <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">avg_forgiven =</span> <span class="fu">mean</span>(amount_forgiven), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">median_forgiven =</span> <span class="fu">median</span>(amount_forgiven)) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (borrower_name, amount_forgiven, avg_forgiven, median_forgiven ) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["borrower_name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["amount_forgiven"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["avg_forgiven"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["median_forgiven"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"SFE HOLDINGS LLC","2":"10108219","3":"69429.99","4":"19631.99"},{"1":"NAVAJO TRIBAL UTILITY AUTHORITY","2":"9882528","3":"69429.99","4":"19631.99"},{"1":"HOME HEALTH AGENCY ARIZONA LLC","2":"10133389","3":"69429.99","4":"19631.99"},{"1":"ARIZONA COMMUNITY PHYSICIANS PC","2":"10131667","3":"69429.99","4":"19631.99"},{"1":"NEXTIVA INC","2":"10126027","3":"69429.99","4":"19631.99"},{"1":"MOUNTAIN PARK HEALTH CENTER","2":"10142917","3":"69429.99","4":"19631.99"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="creating-categories-for-easier-analysis" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="creating-categories-for-easier-analysis"><span class="header-section-number">16.3</span> Creating categories for easier analysis</h2>
<p>Very often, you’ll want to categorize entries in a database in order to make it simpler to count and sum the values in a meaningful way. For example, the <code>business_type</code> column has 24 different values, including <code>NA</code> . Here’s a list with the number of loans in each category:</p>
<div class="cell" data-rows.print="25">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["business_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["# of rows"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Limited  Liability Company(LLC)","2":"57744"},{"1":"Sole Proprietorship","2":"38726"},{"1":"Corporation","2":"27871"},{"1":"Subchapter S Corporation","2":"13777"},{"1":"Independent Contractors","2":"13504"},{"1":"Self-Employed Individuals","2":"10364"},{"1":"Non-Profit Organization","2":"2673"},{"1":"Single Member LLC","2":"1300"},{"1":"Partnership","2":"1190"},{"1":"Limited Liability Partnership","2":"1075"},{"1":"Professional Association","2":"570"},{"1":"501(c)3 – Non Profit","2":"155"},{"1":"501(c)6 – Non Profit Membership","2":"62"},{"1":"NA","2":"42"},{"1":"Cooperative","2":"35"},{"1":"Trust","2":"34"},{"1":"Qualified Joint-Venture (spouses)","2":"32"},{"1":"Tenant in Common","2":"32"},{"1":"Non-Profit Childcare Center","2":"29"},{"1":"Joint Venture","2":"21"},{"1":"Tribal Concerns","2":"15"},{"1":"Employee Stock Ownership Plan(ESOP)","2":"6"},{"1":"501(c)19 – Non Profit Veterans","2":"1"},{"1":"Rollover as Business Start-Ups (ROB","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[25],"max":[25]},"pages":{}}}
  </script>
</div>
</div>
</div>
<section id="yes-no-categories-using-if_else" class="level3">
<h3 class="anchored" data-anchor-id="yes-no-categories-using-if_else">Yes-No categories using <code>if_else()</code></h3>
<p>One way to work with these is to create new columns with yes-no indicators for certain types of businesses like non-profits or individuals vs.&nbsp;companies.</p>
<p>The function to do this is <code>if_else()</code> , which tests a condition exactly the same way <code>filter</code> did, but then assigns a value based on whether it’s met or not. You list the condition first, then a comma , then what should happen if the condition is true, and then what should happen if it’s false.</p>
<p>The condition is done the same way you did it in a filter, but instead of picking out the rows that match, <code>mutate</code> acts on them separately from the rows that don’t match.</p>
<p>There’s no “maybe”, except for NA’s in the original value. Here’s the general form of what it looks like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>new_column_name = if_else ( test the old column for something as in a a filter,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                         give it a value if it's true,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                         give it another value if it's not true)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So here is a way to do this with the business_type using the same %in% operator you used in the <code>filter</code> lesson, saving it to new data frame in your Environment, then displaying the first 10 types of businesses using <code>count()</code></p>
<section id="example-1-two-categories-using-exact-conditions" class="level4">
<h4 class="anchored" data-anchor-id="example-1-two-categories-using-exact-conditions">Example 1: Two categories using exact conditions</h4>
<div class="cell" data-rows.print="10">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ppp_category_indiv <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  ppp_forgiven_fixed <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">is_individual =</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">if_else</span> ( business_type <span class="sc">%in%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">"Independent Contractors"</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Sole Proprietorship"</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Self-Employed Individuals"</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Single Member LLC"</span>), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Individual"</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Organization"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  )  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now print off a sampling of a some of the rows to take a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ppp_category_indiv <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> ( is_individual, business_type) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span> (<span class="dv">50</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["is_individual"],"name":[1],"type":["chr"],"align":["left"]},{"label":["business_type"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Organization","2":"Corporation"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Self-Employed Individuals"},{"1":"Organization","2":"Subchapter S Corporation"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Corporation"},{"1":"Organization","2":"Corporation"},{"1":"Organization","2":"Subchapter S Corporation"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Independent Contractors"},{"1":"Individual","2":"Self-Employed Individuals"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Corporation"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Non-Profit Organization"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Corporation"},{"1":"Organization","2":"Corporation"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Self-Employed Individuals"},{"1":"Individual","2":"Independent Contractors"},{"1":"Organization","2":"Subchapter S Corporation"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Corporation"},{"1":"Individual","2":"Independent Contractors"},{"1":"Individual","2":"Self-Employed Individuals"},{"1":"Organization","2":"Corporation"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Independent Contractors"},{"1":"Organization","2":"Corporation"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Individual","2":"Independent Contractors"},{"1":"Organization","2":"Non-Profit Organization"},{"1":"Organization","2":"Corporation"},{"1":"Individual","2":"Sole Proprietorship"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Organization","2":"Limited  Liability Company(LLC)"},{"1":"Individual","2":"Independent Contractors"},{"1":"Organization","2":"Subchapter S Corporation"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="example-2-two-categories-using-wildcards" class="level4">
<h4 class="anchored" data-anchor-id="example-2-two-categories-using-wildcards">Example 2: Two categories using wildcards</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ppp_category_nonprofit <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  ppp_forgiven_fixed <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">is_nonprofit =</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">if_else</span> ( <span class="fu">str_like</span>(business_type, <span class="st">"%Non_Profit%"</span>) , </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Is nonprofit"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Not nonprofit"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can check it using a new verb, <code>count()</code>, to check the number of items by category:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ppp_category_nonprofit <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> ( is_nonprofit <span class="sc">==</span> <span class="st">"Is nonprofit"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span> ( is_nonprofit, business_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["is_nonprofit"],"name":[1],"type":["chr"],"align":["left"]},{"label":["business_type"],"name":[2],"type":["chr"],"align":["left"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"Is nonprofit","2":"501(c)19 – Non Profit Veterans","3":"1"},{"1":"Is nonprofit","2":"501(c)3 – Non Profit","3":"155"},{"1":"Is nonprofit","2":"501(c)6 – Non Profit Membership","3":"62"},{"1":"Is nonprofit","2":"Non-Profit Childcare Center","3":"29"},{"1":"Is nonprofit","2":"Non-Profit Organization","3":"2673"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>(The profit categorization is unclear for some of the original types, such as professional associations , tribal concerns and cooperatives.)</p>
</section>
</section>
<section id="more-than-two-categories-using-case_when" class="level3">
<h3 class="anchored" data-anchor-id="more-than-two-categories-using-case_when">More than two categories using <code>case_when()</code></h3>
<p>Sometimes you will want more than one outcome, such as setting a value for “High”, “Medium” and “Low”. Instead of <code>if_then</code>, use the function <code>case_when</code>, which lets you string along conditions and their outcomes. The tilde (<code>~</code>) is used to show what happens if it’s true. At the end, you can add an argument <code>.default="Other"</code> to say “everything else”.</p>
<div class="small">
<pre><code>original data |&gt; 
  case_when ( first condition ~ what if it's true,
              second condition ~ what if  it's true, 
              third condition  ~ what if it's true, 
              .default =  what to do with everything that's left
              )</code></pre>
</div>
</section>
</section>
<section id="putting-it-all-together" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">16.4</span> Putting it all together</h2>
<p>Here is how you could set a column to with five types of borrowers instead of three. Once you put it together, you have a much more manageable list of five instead of 25 categories:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a>ppp_business_categories <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a>  ppp_forgiven_fixed <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (  <span class="at">new_business_type =</span> </span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">case_when</span> (  <span class="fu">str_like</span>(business_type, <span class="st">"%non_profit%"</span>) </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-6" class="code-annotation-target"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">~</span> <span class="st">"Non-profit"</span>,</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8" aria-hidden="true" tabindex="-1"></a>                      business_type <span class="sc">%in%</span> </span>
<span id="annotated-cell-10-9"><a href="#annotated-cell-10-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"Independent Contractors"</span>, </span>
<span id="annotated-cell-10-10"><a href="#annotated-cell-10-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Sole Proprietorship"</span>, </span>
<span id="annotated-cell-10-11"><a href="#annotated-cell-10-11" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Self-Employed Individuals"</span>, </span>
<span id="annotated-cell-10-12"><a href="#annotated-cell-10-12" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Single Member LLC"</span>)  </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-13" class="code-annotation-target"><a href="#annotated-cell-10-13" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">~</span> <span class="st">"Individual"</span>,</span>
<span id="annotated-cell-10-14"><a href="#annotated-cell-10-14" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="annotated-cell-10-15"><a href="#annotated-cell-10-15" aria-hidden="true" tabindex="-1"></a>                       business_type <span class="sc">==</span> <span class="st">"Tribal Concerns"</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-10-16" class="code-annotation-target"><a href="#annotated-cell-10-16" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">~</span> <span class="st">"Tribal concerns"</span>,</span>
<span id="annotated-cell-10-17"><a href="#annotated-cell-10-17" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="annotated-cell-10-18"><a href="#annotated-cell-10-18" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_detect</span> (business_type, </span>
<span id="annotated-cell-10-19"><a href="#annotated-cell-10-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"LLC|Company|Corporation|Partnership"</span>) </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-10-20" class="code-annotation-target"><a href="#annotated-cell-10-20" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">~</span> <span class="st">"Companies"</span>,</span>
<span id="annotated-cell-10-21"><a href="#annotated-cell-10-21" aria-hidden="true" tabindex="-1"></a>                      </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-10-22" class="code-annotation-target"><a href="#annotated-cell-10-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.default =</span> <span class="st">"Other"</span></span>
<span id="annotated-cell-10-23"><a href="#annotated-cell-10-23" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="annotated-cell-10-24"><a href="#annotated-cell-10-24" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="6" data-code-annotation="1">The same code you used for non-profits, but with a ~ instead of a comma.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="13" data-code-annotation="2">The same code you used for individuals</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="16" data-code-annotation="3">A new type, for Tribal concerns,</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="20" data-code-annotation="4">and another new type for traditional companies, and</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="22" data-code-annotation="5">finally, what you want it to say when none of the conditions are true.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code chunk uses a function you haven’t seen yet, called <code>str_detect()</code>, which is a powerful way to streamline the conditions. Instead of using <code>str_like()</code>, with its limited wildcards, this is based on <a href="advanced-regex.qmd">regular expressions</a>, which we’ll look at later. But the way it’s used here is to separate words that might be in the description with “|”, for “OR”.</p>
</div>
</div>
<p>Take a look at how the categories are distributed now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-11-1"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a>ppp_business_categories <span class="sc">|&gt;</span></span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span> ( new_business_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["new_business_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Companies","2":"101657"},{"1":"Individual","2":"63894"},{"1":"Non-profit","2":"2920"},{"1":"Other","2":"773"},{"1":"Tribal concerns","2":"15"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<section id="save-it-for-use-in-another-program" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="save-it-for-use-in-another-program">Save it for use in another program</h3>
<p>Saving this for future use means you don’t have to worry anymore about some of the missing values, and you can filter and group by the simpler new business type instead of the original. This saves a data file called <code>ppp_edited.RDS</code> in your project folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ppp_business_categories, <span class="at">file=</span><span class="st">"ppp_edited.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If you skipped converting the <code>NA</code> values above, the answers will always come out as <code>NA</code>. <a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./r-verb-filter.html" class="pagination-link  aria-label=" &lt;span="" in="" depth:="" select,="" arrange,="" filter&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Verbs in depth: Select, arrange, filter</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./r-groupby-story.html" class="pagination-link" aria-label="<span class='chapter-number'>17</span>&nbsp; <span class='chapter-title'>Summarizing detail into totals</span>">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Summarizing detail into totals</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Data reporting for investigative journalism, Spring 2024, written by Sarah Cohen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Produced with <a href="https://quarto.org">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>