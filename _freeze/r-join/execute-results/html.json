{
  "hash": "ee624b98dc1d081382e75bd690b2c4e7",
  "result": {
    "markdown": "---\nexecute:\n  message: false\n  error: true\n---\n\n\n# Verbs in depth: Matchmaking with joins {#r-verb-join}\n\nCongratulations! This is the last key verb that you need to understand to address most stories.\n\n::: {.alert .alert-secondary}\n::: {.alert-heading .font-weight-bolder .fs-3}\nIn this chapter\n:::\n\n-   A `join` combines two or more tables (data frames) by column\n-   joining to data frames requires exact matches on one or more columns. Close matches don't count.\n-   Use codes in one data frame to \"look up\" information in another, and attach it to a row, such as the translation of codes to words or demographics of a Census tract.\n-   Many public records databases come with \"lookup tables\" or \"code sheets\". Make sure to ask for the codes AND their translations in a data request.\n-   Reporters don't always stick to matchmaking the way the database designers intended. \"Enterprise\" joins are those that let you find needles in a haystack, such as bus drivers with a history of DUIs.\n-   Matching one data frame against an entirely different one will always produce mistakes, even if your code runs perfectly. You can minimize the *kind* of error you fear most -- false positives or false negatives -- but you likely will have to report out your findings on the ground.\n:::\n\n## Join basics and relational databases\n\nHere is a great explainer on joins made by a previous MAIJ student, Andy Blye. Be sure to watch it:\n\n\n{{< video https://youtu.be/4xPrnDYZXw4 width=\"400\" height=\"300\" >}}\n\n\n\n\\`joining\" in computer programming match columns in one table [^r-join-1] to another. This is a fundamental way of designing data in both traditional database design and in the tidyverse, where each unit (person, ticket, vehicle) is stored in a different table. Reporters use it in many ways, some intended by the people who made the data source, and some not.\n\n[^r-join-1]: We can use \"table\" and \"data frame\" interchangeably\n\nMany databases are created expecting you to join tables because it's a more efficient way to store and work with large databases. This is what's called a \"relational database\", and they're everywhere (or at least everywhere that has updated its computer systems since 1980 or so). When storage space was expensive, it reduced the size of files because some important information is kept only once, even when it applies to millions of rows. Just as importantly, it means that someone doesn't have to change information in many places -- changing it once applies it to those millions of rows instantly. These are called \"[relational databases](https://enou.co/blog/advantages-of-relational-database/)\".\n\nHere's an example, using campaign finance information. The Federal Elections Commission distributions campaign contribution in *related* tables, each referring to a different noun. One table lists donations, the other lists candidates and other political action committees.\n\n![Campaign finance join](assets/images/r-verb-join-diagram.png){width=\"100%\"}\n\nOne reason to do this is that you never have to worry that any changes to the candidate information -- the treasurer, the address or the office sought -- carries over to the donation. It's only listed once in the candidate table. Most large databases are constructed this way. For example:\n\n-   Your school records are held using your student ID, which means that your address and home email only needs to be changed once, not in every class or in every account you have with the school.\n-   Inspection records, such as those for restaurants, hospitals, housing code violations and workplace safety, typically have at least *three* tables: The establishment (like a restaurant or a workplace), an inspection (an event on a date), and a violation (something that they found). They're linked together using establishment ID's.\n-   A court database usually has many types of records: A master case record links to information on charges, defendants, lawyers, sentences and court hearings.\n\nEach table, then, is described using a different noun -- candidates or contributions; defendants or cases; students or courses. This conforms to the **tidy data** principle that different types of information are stored in different tables.\n\n### join syntax\n\n::: callout-warning\nThere was a huge change in the join verb and its arguments in early 2023. If you have not updated your tidyverse package in a while this may not work. There are actually pretty good explanations of the [concept of joining](https://dtplyr.tidyverse.org/reference/left_join.dtplyr_step.html) and the [variations of it in R](https://dplyr.tidyverse.org/reference/join_by.html) in the documentation.\n:::\n\nThere are several kinds of joins, but the syntax is similar across them.\n\n      old_table |>\n         inner_join (new_table , join_by = (name of old_table column = name of new_table column) )\n         \n\n## Matchmaking with joins\n\nThe type of join described above is often referred to as a \"lookup table\". You'll match codes to their meanings in a way that was intended by the people who made the database. But there are other ways reporters use joins:\n\n### \"Enterprise\" joins {.unnumbered}\n\nJournalists have taken to calling a specific kind of join \"enterprise\", referring to the enterprising reporters who do this. Here, you'll look for needles in a haystack. Some of the most famous data journalism investigations relied on joining two databases that started from completely different sources, such as:\n\n-   Bus drivers who had DUI citations\n-   Donors to a governor who got contracts from the state\n-   Day care workers with criminal records\n\nWhen you match these kinds of datasets, you will always a mistake --- some apparent matches are incorrect in the real world; some matches that should exist don't because of variations in names or other details. You always have to report out any suspected matches, so they are time consuming stories.\n\nIn the mid-2000s, when some politicians insisted that dead people were voting and proposed measures to restrict registration, almost every regional news organization sent reporters on futile hunts for the dead voters. They got lists of people on the voter rolls, then lists of people who had died through the Social Security Death Index or local death certificates. I never met anyone who found a single actual dead voter, but months of reporter-hours were spent tracking down each lead.\n\nIt's very common for two people to have the same name in a city. In fact, it's common to have two people at the same home with the same name -- they've just left off \"Jr.\" and \"Sr.\" in the database. In this case, you'll find matches that you shouldn't. These are false positives, or Type I errors in statistics.\n\nAlso, we rarely get dates of birth or Social Security Numbers in public records, so we have to join by name and sometimes location. If someone has moved, sometimes uses a nickname, or the government has recorded the spelling incorrectly, the join will fail -- you'll miss some of the possible matches. This is very common with company names, which can change with mergers and other changes in management, and can be listed in many different ways.\n\nThese are false negatives, or Type II errors in statistics.[^r-join-2]\n\n[^r-join-2]: I remember them by thinking of the boy who cried wolf. When the village came running and there was no wolf, it was a Type I error, or false positive ; when the village ignored the boy and there was a wolf, it was a Type II error, or false negative.\n\nIn different contexts, you'll want to minimize different kinds of errors. For example, if you are looking for something extremely rare, and you want to examine every possible case -- like a child sex offender working in a day care center -- you might choose to make a \"loose\" match and get lots of false positives, which you can check. If you want to limit your reporting only to the most promising leads, you'll be willing to live with missing some cases in order to be more sure of the joins you find.\n\nYou'll see stories of this kind write around the lack of precision -- they'll often say, \"we verified x cases of....\" rather than pretend that they know of them all.\n\n### Find cases with interesting characteristics {.unnumbered}\n\nYou'll often want to learn more about a geographic area's demographics or voting habits or other characteristics, and match it to other data. Sometimes it's simple: Find the demographics of counties that switched from Trump to Biden as a way to isolate places you might want to visit. Another example from voting might be to find the precinct that has the highest percentage of Latino citizens in the county, then match that precinct against the voter registration rolls to get a list of people you might want to interview on election day. In these instances, the `join` is used for a `filter`.\n\nThis is also common when you have data by zip code or some other geography, and you want to find clusters of interesting potential stories, such as PPP loans in minority neighborhoods.\n\n### Summarize data against another dataset {.unnumbered}\n\nThe previous examples all result in lists of potential story people or places. If you use join on summarized data, you can characterize a broad range of activity across new columns. Simplified, this is how you can write that more PPP money went to predominantly white neighborhoods than those that were majority Black.\n\n## Simple lookup join using PPP industry codes\n\n\n\n\n\nThe PPP data has a code called the `naics_code`, which is a standardized code to identify industries. They are assigned by the company itself or by the bank, not by the government, but they are a good guide. We'll use a data frame that contains the list of industries and match it to the PPP data. (The lookup table was derived from the `concordance` package in R, but is fully explained at the [Census website](https://www.census.gov/naics/?58967?yearbck=2017).)\n\n::: {.alert .alert-success .alert-dothis}\nOnce you load these data frames, be sure to explore them a little to make sure you understand what they contain.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaics_codes <- readRDS( url ( \"https://cronkitedata.s3.amazonaws.com/rdata/naics_lookup.RDS\"))\nppp_orig <- readRDS (url ( \"https://cronkitedata.s3.amazonaws.com/rdata/ppp_az_loans.RDS\"))\n\nglimpse(naics_codes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,043\nColumns: 6\n$ naics_code     <chr> \"111110\", \"111120\", \"111130\", \"111140\", \"111150\", \"1111…\n$ sector_code    <chr> \"11\", \"11\", \"11\", \"11\", \"11\", \"11\", \"11\", \"11\", \"11\", \"…\n$ subsector_code <chr> \"111\", \"111\", \"111\", \"111\", \"111\", \"111\", \"111\", \"111\",…\n$ sector_desc    <chr> \"Agriculture, Forestry, Fishing and Hunting\", \"Agricult…\n$ subsector_desc <chr> \"Crop Production\", \"Crop Production\", \"Crop Production\"…\n$ naics_desc     <chr> \"Soybean Farming\", \"Oilseed (except Soybean) Farming\", …\n```\n:::\n:::\n\n\nHere is a simple example of filtering for the sector that begins with \"72\", then getting information about the loans to industries within that sector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nppp_sector72 <- \n  ppp_orig |> \n  filter ( str_like ( naics_code, \"72%\"))\n```\n:::\n\n\nTo put this together with industry descriptions, you \"join\" it using the column that it has in common -- the `naics_code`. This is an example of an \"inner join\", in which only the rows that match are kept in the result. The result below uses just a few columns from the saved data frame, and then picks out some random rows to view:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloans_with_industry <- \n  ppp_sector72 |>\n  inner_join ( naics_codes, join_by = naics_code)  \n```\n:::\n\n\n(In this case, they have the same column name, but they don't have to. As long as they CONTAIN the same thing, they can have different names. You can also join using more than one column, such as county and state together.)\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Borrower\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"city\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"naics_code\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"sector_desc\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"subsector_desc\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"naics_desc\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"amount\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"CENTURY HOTELS CORPORATION\",\"2\":\"Scottsdale\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"329094.50\"},{\"1\":\"TUCSON TAMALE COMPANY ORACLE LLC\",\"2\":\"Tucson\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"41945.00\"},{\"1\":\"EVELYN HERNANDEZ\",\"2\":\"Surprise\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"20833.00\"},{\"1\":\"S H INVESTORS LLC\",\"2\":\"Winslow\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"62800.00\"},{\"1\":\"OPPIE BAR LTD\",\"2\":\"Tucson\",\"3\":\"722410\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Drinking Places (Alcoholic Beverages)\",\"7\":\"67600.00\"},{\"1\":\"PARK JIN ENTERPRISES INC\",\"2\":\"Tempe\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"14000.00\"},{\"1\":\"FARM AND CRAFT LLC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"390036.50\"},{\"1\":\"BLACK CANYON PARTNERS LLC\",\"2\":\"Phoenix\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"79922.00\"},{\"1\":\"ELVIRAS RESTAURANT LLC\",\"2\":\"Tubac\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"142900.00\"},{\"1\":\"COPPERFUND CAPITAL LLC\",\"2\":\"Flagstaff\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"4787.00\"},{\"1\":\"NYJILL HIGGINS\",\"2\":\"Phoenix\",\"3\":\"722310\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Food Service Contractors\",\"7\":\"3000.00\"},{\"1\":\"UBERRITO ARCADIA LLC\",\"2\":\"Phoenix\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"22611.00\"},{\"1\":\"FRESH DONUTS LLC\",\"2\":\"Buckeye\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"13500.00\"},{\"1\":\"JOSEPH FICO\",\"2\":\"Tucson\",\"3\":\"721310\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Rooming and Boarding Houses\",\"7\":\"5495.00\"},{\"1\":\"EL YAQUI MEXICAN RESTAURANT LLC\",\"2\":\"Phoenix\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"7252.50\"},{\"1\":\"J G FAMILY LLC\",\"2\":\"Glendale\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"10173.00\"},{\"1\":\"CANNONS COOKERY 4 LLC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"165784.00\"},{\"1\":\"HIBACHI SUSHI AND SUPREME BUFFET INC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"27762.00\"},{\"1\":\"LIFES LEMONS SCOTTSDALE LLC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"35122.10\"},{\"1\":\"OUTWEST VENTURES INC\",\"2\":\"Tempe\",\"3\":\"722410\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Drinking Places (Alcoholic Beverages)\",\"7\":\"195971.00\"},{\"1\":\"LOCO PATRON LLC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"356129.00\"},{\"1\":\"LIL ABNERS LTD\",\"2\":\"Tucson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"130343.93\"},{\"1\":\"HAILE INC\",\"2\":\"Yuma\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"202270.00\"},{\"1\":\"THE QUARRY BISBEE LLC\",\"2\":\"Bisbee\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"1973.33\"},{\"1\":\"ARIVACA SOUL FOOD LLC\",\"2\":\"Arivaca\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"9400.00\"},{\"1\":\"AUDREY BATES\",\"2\":\"Surprise\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"18010.00\"},{\"1\":\"MARITEL PROPERTIES LLC\",\"2\":\"Nogales\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"209408.00\"},{\"1\":\"DHD LLC\",\"2\":\"Douglas\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"132823.27\"},{\"1\":\"SPINNING SHAWARMA LLC\",\"2\":\"Tempe\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"22662.00\"},{\"1\":\"KOUZINA DINING GROUP LLC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"52615.00\"},{\"1\":\"FRESH FOOD CONCEPTS LLC\",\"2\":\"Tempe\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"194302.71\"},{\"1\":\"KABUKI GLENDALE INC\",\"2\":\"Glendale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"111200.00\"},{\"1\":\"T M INC\",\"2\":\"Casa Grande\",\"3\":\"721199\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"All Other Traveler Accommodation\",\"7\":\"7200.00\"},{\"1\":\"ASIAN BUFFET RESTAURANT LLC\",\"2\":\"Tucson\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"43892.50\"},{\"1\":\"JANELLE NEELY\",\"2\":\"Phoenix\",\"3\":\"721199\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"All Other Traveler Accommodation\",\"7\":\"20207.00\"},{\"1\":\"AARON AMOS\",\"2\":\"Goodyear\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"18540.00\"},{\"1\":\"SENOR SUSHI PEORIA LLC\",\"2\":\"Peoria\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"44735.00\"},{\"1\":\"TRIDENT III LLC\",\"2\":\"Tucson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"402090.00\"},{\"1\":\"JJ BEAN INC\",\"2\":\"Anthom\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"67846.00\"},{\"1\":\"MHM BUILDERS INC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"76700.00\"},{\"1\":\"KRISTIAN JOHNSON\",\"2\":\"Avondale\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"20197.00\"},{\"1\":\"HG SUBS INC\",\"2\":\"Mesa\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"27289.97\"},{\"1\":\"ARJUN FOODS LLC\",\"2\":\"Chandler\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"56300.00\"},{\"1\":\"CHRISTOS RISTORANTE INC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"108490.00\"},{\"1\":\"MANNA ARROWHEAD INC\",\"2\":\"Peoria\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"114500.00\"},{\"1\":\"GECH LLC\",\"2\":\"Maricopa\",\"3\":\"722310\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Food Service Contractors\",\"7\":\"1875.00\"},{\"1\":\"ALOHA TEA AMP COFFEE\",\"2\":\"Glendale\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"4370.00\"},{\"1\":\"B R LYLES ENTERPRISES\",\"2\":\"Litchfield Park\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"130600.00\"},{\"1\":\"FFH INVESTMENTS LLC\",\"2\":\"Flagstaff\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"154100.00\"},{\"1\":\"NYETICEA GOLDMAN\",\"2\":\"Glendale\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"11983.00\"},{\"1\":\"AHKAI SUSHI GRILL LLC\",\"2\":\"Goodyear\",\"3\":\"721199\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"All Other Traveler Accommodation\",\"7\":\"117002.00\"},{\"1\":\"TITO AND PEP HOSPITALITY LLC\",\"2\":\"Tucson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"288853.77\"},{\"1\":\"RASPADOS SOLARIS LLC\",\"2\":\"Phoenix\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"15165.00\"},{\"1\":\"CHRISTINA ESCALANTE\",\"2\":\"Gilbert\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"20832.00\"},{\"1\":\"PEYTON CHARNICK\",\"2\":\"Bisbee\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"39819.38\"},{\"1\":\"PRO HOSPITALITY NINE LLC\",\"2\":\"Phoenix\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"418901.00\"},{\"1\":\"FOAD YOUSIF\",\"2\":\"Mesa\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"20000.00\"},{\"1\":\"CARUSO INVESTMENT CO INC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"46637.00\"},{\"1\":\"BAKED IN AZ LLC\",\"2\":\"Chandler\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"73080.00\"},{\"1\":\"PRESS WATERFRONT LLC\",\"2\":\"Scottsdale\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"42600.00\"},{\"1\":\"CBCB CROSSROADS LLC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"359100.00\"},{\"1\":\"LORI MUSSER\",\"2\":\"Gilbert\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"6324.59\"},{\"1\":\"INTEGRATED MARKETING INC\",\"2\":\"Scottsdale\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"87200.00\"},{\"1\":\"GEORGIES CAFE LLC\",\"2\":\"Cottonwood\",\"3\":\"722514\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Cafeterias, Grill Buffets, and Buffets\",\"7\":\"84500.00\"},{\"1\":\"DCOHN8\",\"2\":\"Tucson\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"11200.00\"},{\"1\":\"RICE RANCH LLC\",\"2\":\"Quartzsite\",\"3\":\"721211\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"RV (Recreational Vehicle) Parks and Campgrounds\",\"7\":\"10163.00\"},{\"1\":\"THE STEAKNSTUFF RESTAURANT TAVERN\",\"2\":\"Cottonwood\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"48233.00\"},{\"1\":\"EWAS THAI CUISINE LLC\",\"2\":\"Flagstaff\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"24466.11\"},{\"1\":\"111TH PRECINCT LTD\",\"2\":\"Phoenix\",\"3\":\"722410\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Drinking Places (Alcoholic Beverages)\",\"7\":\"147983.00\"},{\"1\":\"SARA SHA LLC\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"85193.00\"},{\"1\":\"P M CONSULTING SERVICING LLC\",\"2\":\"Phoenix\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"9186.00\"},{\"1\":\"HTSS ENTERPRISES LLC\",\"2\":\"Payson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"13975.00\"},{\"1\":\"CHINA RED CAFE INC\",\"2\":\"Litchfield Park\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"55532.00\"},{\"1\":\"FLOYD HUNTER\",\"2\":\"Yuma\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"20833.00\"},{\"1\":\"COFFEE COVE\",\"2\":\"Scottsdale\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"3580.00\"},{\"1\":\"JD RESTAURANT GROUP\",\"2\":\"Peoria\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"161600.00\"},{\"1\":\"CAFE SANTA ROSA BAR BANQUET LLC\",\"2\":\"Tucson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"101423.00\"},{\"1\":\"TOMO AMERICA INC\",\"2\":\"Goodyear\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"144030.00\"},{\"1\":\"75TH AVE OF ARIZONA LP\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"100886.50\"},{\"1\":\"GLADDEN ENTERPRISES INC DBA TACO BELL\",\"2\":\"Phoenix\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"111745.00\"},{\"1\":\"TORREY STRINGER\",\"2\":\"Prescott Valley\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"8200.00\"},{\"1\":\"KYMBERLI MILLER\",\"2\":\"Surprise\",\"3\":\"722320\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Caterers\",\"7\":\"29166.00\"},{\"1\":\"THE HIVE RESTAURANT\",\"2\":\"Wellton\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"29400.00\"},{\"1\":\"MAYREN ALLIN GUERRA\",\"2\":\"Tucson\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"14558.00\"},{\"1\":\"ABK RESTAURANT LLC\",\"2\":\"Mesa\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"4000.00\"},{\"1\":\"GARLIC BISTRO LLC\",\"2\":\"Scottsdale\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"31199.00\"},{\"1\":\"MEGNA MANAGEMENT INC\",\"2\":\"Page\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"94700.00\"},{\"1\":\"OJALA LLC\",\"2\":\"Lake Havasu City\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"15500.00\"},{\"1\":\"MM AHWATUKEE LLC\",\"2\":\"Phoenix\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"189100.00\"},{\"1\":\"DNRW ENTERPRISES INC\",\"2\":\"Gilbert\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"124500.00\"},{\"1\":\"CIAO WINEBAR BISTRO LLC\",\"2\":\"Buckeye\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"114698.50\"},{\"1\":\"MUGS COFFEE IN ARIZONA\",\"2\":\"Phoenix\",\"3\":\"722515\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Snack and Nonalcoholic Beverage Bars\",\"7\":\"13799.03\"},{\"1\":\"COTTONWOOD FAST FOODS INC\",\"2\":\"Flagstaff\",\"3\":\"722513\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Limited-Service Restaurants\",\"7\":\"83800.00\"},{\"1\":\"MIKES STEAK MORE LLC\",\"2\":\"Oracle\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"46560.93\"},{\"1\":\"KETTLELICIOUS LLC\",\"2\":\"Tucson\",\"3\":\"722330\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Mobile Food Services\",\"7\":\"24648.00\"},{\"1\":\"FILLMORE INVESTMENTS\",\"2\":\"Goodyear\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"195251.00\"},{\"1\":\"CALIAS INVESTMENTS LLC DBA BACKBURNER FAMILY RESTAURANT\",\"2\":\"Prescott Valley\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"149800.00\"},{\"1\":\"TEMPE TOWNLAKE INVESTMENTS LLC\",\"2\":\"Tempe\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"127800.00\"},{\"1\":\"MAMPM RESTAURANT LLC\",\"2\":\"Cave Creek\",\"3\":\"722511\",\"4\":\"Accommodation and Food Services\",\"5\":\"Food Services and Drinking Places\",\"6\":\"Full-Service Restaurants\",\"7\":\"125327.00\"},{\"1\":\"KESHAV PROPERTIES INC\",\"2\":\"Fountain Hills\",\"3\":\"721110\",\"4\":\"Accommodation and Food Services\",\"5\":\"Accommodation\",\"6\":\"Hotels (except Casino Hotels) and Motels\",\"7\":\"61529.58\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThink about what this means: You now have another thing for grouping, so you can see, for instance, how much went to restaurants, or which restaurants on your block got loans.\n\n## Joining risks\n\n### joining tl;dr\n\nThere are lots of risks in joining tables that you created yourself, or that were created outside a big relational database system. Keep an eye on the number of rows returned every time that you join -- you should know what to expect.\n\n### Double counting with joins\n\nWe won't go into this in depth, but just be aware it's easy to double-count rows when you join. Here's a made-up example, in which a zip code is on the border and is in two counties:\n\nSay you want to use some data on zip codes :\n\n| zip code | county   | info           |\n|----------|----------|----------------|\n| 85232    | Maricopa | some data      |\n| 85232    | Pinal    | some more data |\n\nand match it to a list of restaurants in a zip code:\n\n| zip code | restaurant name               |\n|----------|-------------------------------|\n| 85232    | My favorite restaurant        |\n| 85232    | My second-favorite restaurant |\n\nWhen you match these, you'll get **4** rows:\n\n| zip code | county   | info           | restaurant name               |\n|----------|----------|----------------|-------------------------------|\n| 85232    | Maricopa | some data      | My favorite restaurant        |\n| 85232    | Pinal    | some more data | My favorite restaurant        |\n| 85232    | Maricopa | some data      | My second-favorite restaurant |\n| 85232    | Pinal    | some more data | My second-favority restaurant |\n\nNow, every time you try to count restaurants, these two will be double-counted.\n\nIn computing, this is called a \"many-to-many\" relationship -- there are many rows of zip codes and many rows of restaurants. In journalism, we call it spaghetti. It's usually an unintended mess.\n\n### Losing rows with joins\n\nThe opposite can occur if you aren't careful and there are items you want to keep that are missing in your reference table. That's what happened in the immunization data above for the seven schools that I couldn't find.\n\n## Resources\n\n-   The \"[Relational data](https://r4ds.had.co.nz/relational-data.html)\" chapter in the R for Data Science textbook has details on exactly how a complex data set might fit together.\n\n-   [An example using a superheroes dataset](https://stat545.com/join-cheatsheet.html#left_joinsuperheroes-publishers), from Stat 545 at the University of British Columbia\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}