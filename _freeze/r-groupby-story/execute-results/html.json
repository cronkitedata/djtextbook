{
  "hash": "746173792609296612ed25d9088358ea",
  "result": {
    "markdown": "# Summarizing detail into totals {#r-groupby-story}\n\nIn the wake of a police shooting in 2016, reporter Mitch Smith obtained a [list of traffic stops](https://cronkitedata.s3.amazonaws.com/xlfiles/saintanthony_police.xlsx) from the St. Anthony Police Department in Minnesota. He was writing a story on Philandro Castile's death and was running out of time. He wanted to answer a simple question: Were minority motorists more likely to be stopped in St. Anthony than whites?\n\nRob Gebeloff made a quick pivot table to answer the question. That night, [Smith wrote](https://www.nytimes.com/2016/07/13/us/philando-castile-minnesota-police-shooting.html):\n\n> In each of the three small suburbs patrolled by the St. Anthony police, less than 10 percent of the population is black. But data released by the city on Tuesday showed that a far higher percentage of the people ticketed or arrested by St. Anthony officers were African-American.\n>\n> Last year, around 19 percent of those cited by St. Anthony police were black, as were roughly 41 percent of people arrested by the department, a review of the city's data showed. Those percentages do not include the large number of defendants whose race was unknown.\n\n## Summarizing with groups\n\nSummarizing a list of items in R is done using the verbs `group_by` and `summarize`. Think of grouping as answering the questions, \"How many?\" and \"How much?\". They are particularly powerful when your question also has the words \"the most\" or the \"the least\" or \"of each\". Some examples:\n\n-   Which *Zip Code* had *the most* crimes?\n-   What *month* had *the least* total rainfall?\n-   *How much* did *each candidate* raise last quarter?\n-   In playing cards, *how many* of *each suit* do I have in my hand?\n-   On average, are *Cronkite students* *taller or shorter* than in other schools?\n\n### Confusing grouping with sorting or arranging \n\nMany reporters confuse this summarization with \"sorting\". One reason is that this is how we express the concept in plain language: \"I want to sort Skittles by color\".\n\nBut in data analysis, sorting and and grouping are very different things. *Sorting*, which is done in R via the `arrange()` verb, involves shuffling a data frame's rows into some order based on the values in a column.  *Grouping* is a way to aggregate and compute summary statistics such as a count (the number of items), sum (how much they add up to), or average for category. It means \"make piles and compute statistics for each one.\" \n\n### When to use filter vs. summary \n\nSomething that trips up beginners is a desire to see details and totals at the same time, which is more difficult than it sounds.\n\nA filter is used to *display* your selected items as a list. You'll get to see all of the detail and every column. As a convenience, R shows you how many items are in that filtered list (usually). That's great when you want to just look at them, or get more information about them. For instance, if you had a list of crimes by ZIP code, you might just want to see the list in your neighborhood -- where, exactly, were they? When did they happen? Was it at night or the morning? What crimes happened on which blocks?\n\nAggregates are used when you *just want to see summaries* -- does my ZIP code have more crime than others? Are robberies more common than car theft in my Zip code, and how does that compare to others?\n\nIn practice, you'll go back and forth between summary and detail. They're both important, just different.\n\n## Motivational exercise\n\nThis exercise helps you internalize the differences between filtering and aggregating (or grouping). It uses a list of fatal police shootings logged by the Washington Post, downloaded in late 2022. The column names are pretty self-explanatory, and we'll only be looking at the `ethnicity` column. (Scroll to the right if you can't see it.)\n\n::: callout-dothis\n\n1. Create a Quarto document in your project\n2. Add the usual setup chunk to load the tidyverse, using the library command. Copy and paste the chunk from a previous lesson if you need to. \n3. Copy and paste this into a code chunk to read the data.\n\n::: \n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings <- \n  readRDS ( \n        url ( \n           \"https://cronkitedata.s3.amazonaws.com/rdata/waposhootings.RDS\"\n           )\n        )\n```\n:::\n\n\n\nExamine the data: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  sample_n (50)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"year\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"armed\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ethnicity\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"flee\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Joseph Jewell\",\"2\":\"2020\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Jerome Damon\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"John Timmons\",\"2\":\"2017\",\"3\":\"gun\",\"4\":\"unknown\",\"5\":\"Not fleeing\"},{\"1\":\"Joshua Crittenden\",\"2\":\"2015\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Glenn Tyndell\",\"2\":\"2018\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Car\"},{\"1\":\"Marcus Williams\",\"2\":\"2017\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"Riley Eugene Peay\",\"2\":\"2019\",\"3\":\"unarmed\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Bobby Lee Vaughn\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Mycael Johnson\",\"2\":\"2020\",\"3\":\"unarmed\",\"4\":\"Black, non-Hispanic\",\"5\":\"Other\"},{\"1\":\"Skyler Martin\",\"2\":\"2018\",\"3\":\"gun\",\"4\":\"Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Martin Allen Goodier\",\"2\":\"2019\",\"3\":\"knife\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Alva Burnett Braziel\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Charles Bertram\",\"2\":\"2015\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Car\"},{\"1\":\"Timothy Owen\",\"2\":\"2018\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Christine A. Lucas\",\"2\":\"2016\",\"3\":\"toy weapon\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Scott Johnson\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Roy Dale Evans\",\"2\":\"2017\",\"3\":\"unarmed\",\"4\":\"White, non-Hispanic\",\"5\":\"Car\"},{\"1\":\"Josef Delon Richardson\",\"2\":\"2019\",\"3\":\"unarmed\",\"4\":\"Black, non-Hispanic\",\"5\":\"NA\"},{\"1\":\"Darrel S. Machemehl\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Other\"},{\"1\":\"Rodolfo Martinez-Cortez\",\"2\":\"2020\",\"3\":\"gun\",\"4\":\"Hispanic\",\"5\":\"Foot\"},{\"1\":\"Jessie Thedford\",\"2\":\"2018\",\"3\":\"vehicle\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"William Slyter\",\"2\":\"2020\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Other\"},{\"1\":\"Richard J. Jones\",\"2\":\"2020\",\"3\":\"knife\",\"4\":\"unknown\",\"5\":\"Not fleeing\"},{\"1\":\"Renee Davis\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"Native American\",\"5\":\"Not fleeing\"},{\"1\":\"Jorevis Scruggs\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Other\"},{\"1\":\"Joel Jacobo\",\"2\":\"2018\",\"3\":\"unknown weapon\",\"4\":\"Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"John O'Handley\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Glenn Watenpool\",\"2\":\"2017\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Garry Glenn Lawrence\",\"2\":\"2018\",\"3\":\"ax\",\"4\":\"White, non-Hispanic\",\"5\":\"NA\"},{\"1\":\"Keith William Brunelle\",\"2\":\"2020\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Tobby Wiggins\",\"2\":\"2020\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"Michael Lee Nguyen\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"Asian\",\"5\":\"Not fleeing\"},{\"1\":\"Michael Uccello\",\"2\":\"2019\",\"3\":\"vehicle\",\"4\":\"White, non-Hispanic\",\"5\":\"Car\"},{\"1\":\"Aubrey Manning\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Dean Bruning\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Nakia Smith\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"NA\",\"2\":\"2017\",\"3\":\"gun\",\"4\":\"unknown\",\"5\":\"Not fleeing\"},{\"1\":\"Willie Bo McCoy\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"John Luce\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"Travis Ell\",\"2\":\"2016\",\"3\":\"unknown weapon\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"David Novak\",\"2\":\"2019\",\"3\":\"baseball bat\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Justin Smith\",\"2\":\"2018\",\"3\":\"knife\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Daniel David Messmer\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Damon Barstad\",\"2\":\"2018\",\"3\":\"Taser\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Michael Neal\",\"2\":\"2018\",\"3\":\"undetermined\",\"4\":\"White, non-Hispanic\",\"5\":\"Car\"},{\"1\":\"Edward Donnell Bright\",\"2\":\"2015\",\"3\":\"knife\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Shawn Henry Allen Dickens\",\"2\":\"2016\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"Jeffery Tyler Aycock\",\"2\":\"2019\",\"3\":\"gun\",\"4\":\"White, non-Hispanic\",\"5\":\"Foot\"},{\"1\":\"Lamar Green\",\"2\":\"2018\",\"3\":\"gun\",\"4\":\"Black, non-Hispanic\",\"5\":\"Not fleeing\"},{\"1\":\"Stoney McJunkin\",\"2\":\"2017\",\"3\":\"metal pipe\",\"4\":\"White, non-Hispanic\",\"5\":\"Not fleeing\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n### Filtering method\n\nUsing a pen and paper, write out something that looks like the table below. The total number comes from the number of rows in the data frame. \n\n| Ethnicity | # of victims | % of total |\n| --------- | ------ | ----- |\n| Black, non-Hispanic | | |\n| White, non-Hispanic | | | \n| Hispanic | | |\n| TOTAL |   5,945 | 100%  |\n: {.table-bordered}\n\n::: callout-dothis\nCopy and paste this code to list all fatal shootings of Black, non-Hispanic victims. Look at the number of rows returned and enter it into your handmade table.\n::: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  filter ( ethnicity == \"Black, non-Hispanic\")\n```\n:::\n\n\n\n::: callout-dothis\n\nRun this code to get the number of White, non-Hispanic victims and write the answer down on your handmade table\n\n::: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  filter ( ethnicity == \"White, non-Hispanic\")\n```\n:::\n\n\n\n::: callout-dothis\nRun this filter to get the number of Hispanic victims, and write the answer down.\n::: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  filter ( ethnicity == \"Hispanic\")\n```\n:::\n\n\n\n\n#### Compute the percentages\n\n::: callout-dothis\n\n1. Compute the percent of total each group represents. Do this on a calculator (or just type the formula into Google).  Remember, the percent of total formula is: `group / total * 100` \n\n2. Write the answers into your handwritten chart. \n\n3. Now, rewrite your chart so that the highest percentage is on the first row, the second highest on the second row, and the third highest on the third row.\n\n4. Repeat your calculations, since you always have to do every hand calculation twice. They won't add up to 100% because we left out people who had an unknown ethnicity or other ethnicity.\n\n::: \n\n\n## Aggregating for an easier way\n\nThat's a lot of work. Imagine if you had to do this 50 times for 50 states, or even more for every Zip code? There has to be an easier way, and there is: Grouping and summarizing. \n\n\nWe'll build the code one piece at a time so you can see what's happening: \n\n::: callout-dothis\n\nCopy this code, one chunk at a time, into your Quarto document and run them to see what the answers are.\n\n::: \n\n\n1. Get the totals\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  summarize ( num_shootings = n() ) \n```\n:::\n\n\n\n2. Add a \"group\" to summarize by ethnicity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  group_by (ethnicity) |> \n  summarize (num_shootings = n() )\n```\n:::\n\n\n\n3. Arrange to get the highest number at the top\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  group_by ( ethnicity) |> \n  summarize (num_shootings = n() ) |> \n  arrange ( desc (num_shootings ))\n```\n:::\n\n\n\n4. Compute the percent \n\n    Notice that the \"mutate\" line is exactly the same formula you typed into your calculator. The only difference is that we computed the total number of shootings instead of typing it. <br>\n \n    This is one of the most common patterns you'll use in data reporting, and we can get much more sophisticated with it. Don't expect to understand it fully right away, but you should recognize the idea: If you find yourself filtering in order to count something, consider using grouping instead. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaposhootings |> \n  group_by ( ethnicity) |> \n  summarize ( num_shootings = n() ) |> \n  mutate ( total = sum ( num_shootings ) , \n           percent = num_shootings /total * 100 ) |> \n  arrange ( desc ( num_shootings))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"ethnicity\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"num_shootings\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"percent\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"White, non-Hispanic\",\"2\":\"2771\",\"3\":\"5945\",\"4\":\"46.6105971\"},{\"1\":\"Black, non-Hispanic\",\"2\":\"1444\",\"3\":\"5945\",\"4\":\"24.2893188\"},{\"1\":\"Hispanic\",\"2\":\"1021\",\"3\":\"5945\",\"4\":\"17.1740959\"},{\"1\":\"unknown\",\"2\":\"473\",\"3\":\"5945\",\"4\":\"7.9562658\"},{\"1\":\"Asian\",\"2\":\"103\",\"3\":\"5945\",\"4\":\"1.7325484\"},{\"1\":\"Native American\",\"2\":\"86\",\"3\":\"5945\",\"4\":\"1.4465938\"},{\"1\":\"Other\",\"2\":\"47\",\"3\":\"5945\",\"4\":\"0.7905803\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## Differences\n\nWhen you filtered, you could see the details of every row. That's great if you want to explore it or find examples. But it's not great for that sentence you need when you want to say which group is the largest or smallest, or compare the numbers across groups. \n\nWhen you grouped, you got statistics by ethnicity, but you couldn't see the details. \n\nTypically, you'll go back and forth between aggregating and filtering, using each method to get to different goals. Don't fall in the trap of trying to force all of your questions into a filter, or all of your questions into aggregation. Instead, think about which method will give you the answers you want most efficiently.\n\n## Your questions: \n\n::: callout-dothis\n\nOn your Quarto document, try to write out, in plain English, what you just did. See if you can articulate what the difference between filtering and aggregating is, in your own words. \n\n::: \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}