{
  "hash": "4d3f370820e6438857f3fc37c42ce15d",
  "result": {
    "markdown": "# Verbs in depth:  Matchmaking with joins { #r-verb-join}\n\n:::{.alert .alert-secondary}\n\n<p class=\"alert-heading font-weight-bolder fs-3\">\nIn this chapter\n</p>\n\n*  A `join` combines two or more tables (data frames) by column \n*  joining to data frames requires exact matches on one or more columns. Close matches don't count. \n*  Use codes in one data frame to \"look up\" information in another, and attach it to a row, such as the translation of codes to words or demographics of a Census tract.  \n*  Many public records databases come with \"lookup tables\" or \"code sheets\". Make sure to ask for the codes AND their translations in a data request. \n*  Reporters don't always stick to matchmaking the way the database designers intended. \"Enterprise\" joins are those that let you find needles in a haystack, such as bus drivers with a history of DUIs. \n*  Matching one data frame against an entirely different one will always produce errors. You can minimize the *kind* of error you fear most -- false positives or false negatives -- but you likely will have to report out your findings on the ground. \n::: \n\n\n## Join basics \n\nHere is a great explainer on joins made by a previous MAIJ student, Andy Blye. Be sure to watch it: \n\n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/4xPrnDYZXw4\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n`joins` in computer programming means adding columns to a data frame by combining it with another data frame or table.  Reporters use it in many ways, some intended by the people who made the data source, and some not.^[From now on, we'll start using the term \"table\" instead of \"data frame\", since we can talk about several different ones at the same time.] \n\nMany databases are created expecting you to join tables (data frames) because it's a more efficient way to store and work with large databases. This is what's called a \"relational database\", and they're everywhere (or at least everywhere that has updated its computer systems since 1980 or so).  \n\nHere's an example, using campaign finance information. The Federal Elections Commission distributions campaign contribution in *related* tables, each referring to a different noun. One table lists donations, the other lists candidates and other political action committees. They link together using a common code: \n\n![Campaign finance join](assets/images/r-verb-join-diagram.png){width=100%}\n\n\nThe reason to do this is that you never have to worry that any changes to the candidate information -- the treasurer, the address or the office sought -- carries over to the donation. It's only listed once in the candidate table. Most large databases are constructed this way. For example:\n\n* Your school records are held using your student ID, which means that your address and home email only needs to be changed once, not in every class or in every account you have with the school. \n* Inspection records, such as those for restaurants, hospitals, housing code violations and workplace safety, typically have at least *three* tables: The establishment (like a restaurant or a workplace), an inspection (an event on a date), and a violation (something that they found). They're linked together using establishment ID's. \n* A court database usually has many types of records: A master case record links to information on charges, defendants, lawyers, sentences and court hearings. \n\nEach table, then, is described using a different noun -- candidates or contributions; defendants or cases; students or courses. This conforms to the **tidy data** principle that different types of information are stored in different tables. \n\n### join syntax \n\nThere are several kinds of joins, but the syntax is similar across them. \n\n```\n  old_table_1 %>%\n     inner_join (new_table , by=c(\"old table col. name\" = \"new table col. name\") )\n     \n```\n\n## Matchmaking with joins\n\nThe type of join described above is often referred to as a \"lookup table\". You'll match codes to their meanings in a way that was intended by the people who made the database. \nBut there are other ways reporters use joins: \n\n###  \"Enterprise\" joins {-}\n\nJournalists have taken to calling a specific kind of join \"enterprise\", referring to the enterprising reporters who do this. Here, you'll look for needles in  a haystack. Some of the most famous data journalism investigations relied on joining two databases that started from completely different sources, such as: \n\n* Bus drivers who had DUI citations \n* Donors to a governor who got contracts from the state\n* Day care workers with criminal records \n* Small businesses that have defaulted on government backed loans that got a PPP loan anyway.\n\nWhen you match these kinds of datasets, you will always have some error. You always have to report out any suspected matches, so they are time consuming stories. \n\nIn the mid-2000s, when some politicians insisted that dead people were voting and proposed measures to restrict registration, almost every regional news organization sent reporters on futile hunts for the dead voters. They got lists of people on the voter rolls, then lists of people who had died through the Social Security Death Index or local death certificates. I never met anyone who found a single actual dead voter, but months of reporter-hours were spent tracking down each lead.\n\nIt's very common for two people to have the same name in a city. In fact, it's common to have two people at the same home with the same name -- they've just left off \"Jr.\" and \"Sr.\" in the database. In this case, you'll find matches that you shouldn't.  These are false positives, or Type I errors in statistics. \n\nAlso, we rarely get dates of birth or Social Security Numbers in public records, so we have to join by name and sometimes location. If someone has moved, sometimes uses a nickname, or the government has recorded the spelling incorrectly, the join will fail -- you'll miss some of the possible matches. This is very common with company names, which can change with mergers and other changes in management, and can be listed in many different ways. \n\nThese are false negatives, or Type II errors in statistics.^[I remember them by thinking of the boy who cried wolf. When the village came running and there was no wolf, it was a Type I error, or false positive ; when the village ignored the boy and there was a wolf, it was a Type II error, or false negative.]\n\nIn different contexts, you'll want to minimize different kinds of errors. For example, if you are looking for something extremely rare, and you want to examine every possible case -- like a child sex offender working in a day care center -- you might choose to make a \"loose\" match and get lots of false positives, which you can check. If you want to limit your reporting only to the most promising leads, you'll be willing to live with missing some cases in order to be  more sure of the joins you find. \n\nYou'll see stories of this kind write around the lack of precision -- they'll often say, \"we verified x cases of....\" rather than pretend that they know of them all. \n\n### Find cases with interesting characteristics {-}\n\nYou'll often want to learn more about a geographic area's demographics or voting habits or other characteristics, and match it to other data. Sometimes it's simple: Find the demographics of counties that switched from Trump to Biden as a way to isolate places you might want to visit. Another example from voting might be to find the precinct that has the highest percentage of Latino citizens in the county, then match that precinct against the voter registration rolls to get a list of people you might want to interview on election day. In these instances, the `join` is used for a `filter`. \n\nThis is also common when you have data by zip code or some other geography, and you want to find clusters of interesting potential stories, such as PPP loans in minority neighborhoods. \n\n### Summarize data against another dataset {-}\n\nThe previous examples all result in lists of potential story people or places. If you use join on summarized data, you can characterize a broad range of activity across new columns. Simplified, this is how you can write that more PPP money went to predominantly white neighborhoods than those that were majority Black.  \n\n## Simple join using PPP industry codes\n\n\n\n\n\n\n\nThe PPP data has a code called the `naics_code`, which is a standardized code to identify industries. They are assigned by the company itself or by the bank, not by the government, but they are a good guide. Here is a data frame that contains the list of industries in the PPP data. It was derived from the `concordance` package in R, but is fully explained at the [Census website](https://www.census.gov/naics/?58967?yearbck=2017).\n\nHere are the two tables: The original PPP data, and the industry code \"lookup\". \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaics_codes <- readRDS( url ( \"https://cronkitedata.s3.amazonaws.com/rdata/naics_lookup.RDS\"))\n\nppp_orig <- readRDS (url ( \"https://cronkitedata.s3.amazonaws.com/rdata/ppp_az_loans.RDS\"))\n```\n:::\n\n\n\nHere is an example of looking at one sector -- the sector code \"72\" has subsectors and industry codes. Each digit in the code after the 72 refers to a different definition. Those tha end in zero are not as specific as those that have a digit.: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaics_codes %>% filter ( sector_code == \"72\") %>%\n  select (-sector_code, -subsector_code)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"naics_code\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"sector_desc\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"subsector_desc\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"naics_desc\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"721110\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"Hotels (except Casino Hotels) and Motels\"},{\"1\":\"721120\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"Casino Hotels\"},{\"1\":\"721191\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"Bed-and-Breakfast Inns\"},{\"1\":\"721199\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"All Other Traveler Accommodation\"},{\"1\":\"721211\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"RV (Recreational Vehicle) Parks and Campgrounds\"},{\"1\":\"721214\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"Recreational and Vacation Camps (except Campgrounds)\"},{\"1\":\"721310\",\"2\":\"Accommodation and Food Services\",\"3\":\"Accommodation\",\"4\":\"Rooming and Boarding Houses\"},{\"1\":\"722110\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"NA\"},{\"1\":\"722211\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"NA\"},{\"1\":\"722310\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Food Service Contractors\"},{\"1\":\"722320\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Caterers\"},{\"1\":\"722330\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Mobile Food Services\"},{\"1\":\"722410\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Drinking Places (Alcoholic Beverages)\"},{\"1\":\"722511\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Full-Service Restaurants\"},{\"1\":\"722513\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Limited-Service Restaurants\"},{\"1\":\"722514\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Cafeterias, Grill Buffets, and Buffets\"},{\"1\":\"722515\",\"2\":\"Accommodation and Food Services\",\"3\":\"Food Services and Drinking Places\",\"4\":\"Snack and Nonalcoholic Beverage Bars\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nTo put this together with the PPP data, you \"join\" it using the column that it has in common -- the `naics_code`.  This is an example of an \"inner join\", in which only the rows that match are kept in the result. The result below uses just a few columns from the saved data frame, and then picks out some random rows to view: \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloans_with_industry <- \n  ppp_orig %>%\n  inner_join ( naics_codes, by=c(\"naics_code\"=\"naics_code\"))  \n```\n:::\n\n\n\n(In this case, they have the same column name, but they don't have to. As long as they CONTAIN the same thing, they can have different names. You can also join using more than one column, such as county and state together.)\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"reactable html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-f0a05c120578b213b006\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f0a05c120578b213b006\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Borrower\":[\"COLOR U FAMOUS SALON\",\"JAK BROTHERS FOOD LLC\",\"JABARI JACKSON\",\"CROSSROADS CHURCH OF THE NAZARENE INC\",\"EIGHTY HOUR WEEKS LLC\",\"MELISSA HUDSON\",\"WACO LLC\",\"AZ WHOLESALE WATER AND ICE LLC\",\"KAREN S STARK MD PLLC\",\"JJ EXPRESS VENTURES LLC\",\"DESIGNS WEST INC\",\"CRESCENDO PLUMBING INC\",\"DAVID L TICK\",\"AMBITIOUS SPROUTS LLC\",\"CHESTON LEE\",\"LONGEVITY WELLNESS PARTNERS\",\"BARTON GODFREY\",\"DRAGON INVESTMENTS LLC\",\"TYRONE TAYLOR JR\",\"SUN WEST TERMITE PEST MGT IN\",\"PAR AVION LLC\",\"DESERT ORTHOPEDIC SPECIALISTS PC\",\"VIDAL EQUINE PLLC\",\"ADVANCED CLEAN ENERGY LLC\",\"DIPA AGARWAL\",\"YUMA ENDOSCOPY CENTER LLC\",\"WENDY GUARECA COLON\",\"ANTOINETTE GASTON\",\"VICTOR ARROYO\",\"ASIA POPE\",\"LIMITLESS ENTERTAINMENT LLC\",\"PURE BODY HEALTH LLC\",\"RUBBER SHARK LLC\",\"THE NAIL SHOP LLC\",\"KARENS KREAMERY INC\",\"HR WISE LLC\",\"NAMPN CORRALITO LLC\",\"WARREN LAUTZ\",\"WOODLAND HILLS CLEANING MAINTENANCE\",\"RATANADILOK ENTERPRISES LLC\",\"CADIENTE CONSTRUCTION LLC\",\"DHTJW CONSULTING INC\",\"JOHN WEIBLE\",\"CHICAGO EATS LLC\",\"ARIZONA SOUND PRODUCTIONS\",\"MICHELLE DE LEON REAL ESTATE\",\"ROSE VILLA ASSISTED LIVING HOME I LLC\",\"KATHLEEN HENDERSON\",\"KEVIN MARTINEZ VILLAR\",\"AEROMIL INDUSTRIAL COATINGS\",\"MICHELLE HARVEY CPA PC\",\"HEDGEHOG LANDSCAPING INC\",\"ORO BREWING COMPANY LLC\",\"IMMANUEL CARING MINISTRIES\",\"MIOSHA SCOTT\",\"JEK INVESTMENTS LLC\",\"TNT MESSENGER SERVICE LLC\",\"SIERRA VISTA VISION LLC\",\"BUTTERMORE ENTERPRISES LLC\",\"CHS3 LLC\",\"D E RESALE\",\"CNE LLC\",\"CARMELLA BAKER\",\"COBRA LLC\",\"ALBERT CEREN\",\"LIFE IS GOOD CHIROPRACTIC INC\",\"COHILLS BUIDLING SPECIALTIES INC\",\"FAM INDUSTRIES LLC\",\"ELIZABETH EISENMANN\",\"RIYADH ALALAKI\",\"CLEMENT ENTERPRISES INC\",\"PHATIMA NEWTON\",\"IM CONSULTING ACCOUNTING\",\"CHRISTOPHER MILLER\",\"KEVIN KIRKWOOD PLLC\",\"LELAND GIST\",\"DRE FINANCIAL LLC\",\"KADESIA HALL\",\"GRAVITATE SMOKE SHOP LLC\",\"BURDICK RESIDENTIAL APPRAISAL\",\"THOMAS SILVA\",\"KATRINA WISE\",\"EFFORTLESS MOBILE AUTO SERVICES INC\",\"PEGGIE VASQUEZ\",\"COCHISE ONCOLOGY LLC\",\"INSPIRE TRANSFORM LLC\",\"LINH NGUYEN\",\"TYRA FLOWERS\",\"PHOENICIAN PLUMBING LLC\",\"TODD\",\"KAMCOR LLC\",\"KRISANNA SALON LLC\",\"WIRICK INSURANCE LLC\",\"BARTON FRANCHISE GROUP LLC\",\"NICK IZAD\",\"ZERRY JACKSON\",\"CHANCES FOR CHILDREN\",\"NICHOLAS HALAS\",\"CABN ENTERPRISES INC\",\"CHRISTINA MEDINA\"],\"city\":[\"Peoira\",\"Phoenix\",\"Mesa\",\"Chandler\",\"Gilbert\",\"Tempe\",\"Phoenix\",\"Lake Havasu City\",\"Scottsdale\",\"Tucson\",\"Flagstaff\",\"Mesa\",\"Tucson\",\"Chandler\",\"Phoenix\",\"Phoenix\",\"Mesa\",\"Gilbert\",\"Mesa\",\"Mesa\",\"Scottsdale\",\"Chandler\",\"Phoenix\",\"Chandler\",\"Sierra Vista\",\"Yuma\",\"Mesa\",\"Phoenix\",\"Laveen\",\"Buckeye\",\"Scottsdale\",\"Tempe\",\"Mesa\",\"Peoria\",\"Avondale\",\"Scottsdale\",\"Clifton\",\"Mesa\",\"Phoenix\",\"Tucson\",\"Gilbert\",\"Tucson\",\"Queen Creek\",\"Chandler\",\"Chandler\",\"Tucson\",\"Phoenix\",\"Prescott\",\"Phoenix\",\"Phoenix\",\"Yuma\",\"Scottsdale\",\"Mesa\",\"Peoria\",\"Phoenix\",\"Phoenix\",\"Tucson\",\"Sierra Vista\",\"Buckeye\",\"Morristown\",\"Chandler\",\"Kingman\",\"Mesa\",\"Phoenix\",\"Anthem\",\"Tucson\",\"Phoenix\",\"Queen Creek\",\"Oro Valley\",\"Glendale\",\"Phoenix\",\"Phoenix\",\"Phoenix\",\"Mesa\",\"Tempe\",\"Litchfield Park\",\"Chandler\",\"Casa Grande\",\"Scottsdale\",\"Tucson\",\"Peoria\",\"Yuma\",\"Phoenix\",\"Tucson\",\"Sierra Vista\",\"Gilbert\",\"Phoenix\",\"Phoenix\",\"Peoria\",\"Chandler\",\"Phoenix\",\"Goodyear\",\"Prescott\",\"Gilbert\",\"Phoenix\",\"Queen Creek\",\"Scottsdale\",\"Phoenix\",\"Mesa\",\"Avondale\"],\"naics_code\":[\"812112\",\"722513\",\"484110\",\"813110\",\"561499\",\"541211\",\"237110\",\"445299\",\"621111\",\"999990\",\"442110\",\"238220\",\"524210\",\"611699\",\"323111\",\"454110\",\"443142\",\"713990\",\"561720\",\"561710\",\"423860\",\"621111\",\"541940\",\"333611\",\"721110\",\"621493\",\"722330\",\"448120\",\"711410\",\"812990\",\"711130\",\"621111\",\"441320\",\"812113\",\"722330\",\"541214\",\"999990\",\"541519\",\"811490\",\"423940\",\"236118\",\"541519\",\"541921\",\"722513\",\"238210\",\"531210\",\"623312\",\"445299\",\"722320\",\"325510\",\"541211\",\"561730\",\"424810\",\"623990\",\"624410\",\"525920\",\"492110\",\"621320\",\"541618\",\"721110\",null,\"722513\",\"531210\",\"238330\",\"531390\",\"621512\",null,\"541611\",\"531210\",\"485310\",\"523930\",\"561740\",\"541219\",\"541990\",\"531210\",\"812111\",\"541990\",\"812112\",\"453991\",\"531320\",\"311991\",\"812112\",\"811192\",\"621399\",\"621111\",\"713940\",\"812113\",\"561990\",\"238220\",\"621210\",\"541199\",\"812112\",\"524210\",\"722511\",\"339116\",\"522220\",\"813410\",\"236118\",\"238320\",\"531210\"],\"sector_desc\":[\"Other Services\",\"Accommodation and Food Services\",\"Transportation and Warehousing\",\"Other Services\",\"Administrative and Waste Services\",\"Professional and Technical Services\",\"Construction\",\"Retail Trade\",\"Health Care and Social Assistance\",\"Unclassified establishments\",\"Retail Trade\",\"Construction\",\"Finance and Insurance\",\"Educational Services\",\"Manufacturing\",\"Retail Trade\",\"Retail Trade\",\"Arts, Entertainment, and Recreation\",\"Administrative and Waste Services\",\"Administrative and Waste Services\",\"Wholesale Trade\",\"Health Care and Social Assistance\",\"Professional and Technical Services\",\"Manufacturing\",\"Accommodation and Food Services\",\"Health Care and Social Assistance\",\"Accommodation and Food Services\",\"Retail Trade\",\"Arts, Entertainment, and Recreation\",\"Other Services\",\"Arts, Entertainment, and Recreation\",\"Health Care and Social Assistance\",\"Retail Trade\",\"Other Services\",\"Accommodation and Food Services\",\"Professional and Technical Services\",\"Unclassified establishments\",\"Professional and Technical Services\",\"Other Services\",\"Wholesale Trade\",\"Construction\",\"Professional and Technical Services\",\"Professional and Technical Services\",\"Accommodation and Food Services\",\"Construction\",\"Real Estate and Rental and Leasing\",\"Health Care and Social Assistance\",\"Retail Trade\",\"Accommodation and Food Services\",\"Manufacturing\",\"Professional and Technical Services\",\"Administrative and Waste Services\",\"Wholesale Trade\",\"Health Care and Social Assistance\",\"Health Care and Social Assistance\",\"Finance and Insurance\",\"Transportation and Warehousing\",\"Health Care and Social Assistance\",\"Professional and Technical Services\",\"Accommodation and Food Services\",null,\"Accommodation and Food Services\",\"Real Estate and Rental and Leasing\",\"Construction\",\"Real Estate and Rental and Leasing\",\"Health Care and Social Assistance\",null,\"Professional and Technical Services\",\"Real Estate and Rental and Leasing\",\"Transportation and Warehousing\",\"Finance and Insurance\",\"Administrative and Waste Services\",\"Professional and Technical Services\",\"Professional and Technical Services\",\"Real Estate and Rental and Leasing\",\"Other Services\",\"Professional and Technical Services\",\"Other Services\",\"Retail Trade\",\"Real Estate and Rental and Leasing\",\"Manufacturing\",\"Other Services\",\"Other Services\",\"Health Care and Social Assistance\",\"Health Care and Social Assistance\",\"Arts, Entertainment, and Recreation\",\"Other Services\",\"Administrative and Waste Services\",\"Construction\",\"Health Care and Social Assistance\",\"Professional and Technical Services\",\"Other Services\",\"Finance and Insurance\",\"Accommodation and Food Services\",\"Manufacturing\",\"Finance and Insurance\",\"Other Services\",\"Construction\",\"Construction\",\"Real Estate and Rental and Leasing\"],\"subsector_desc\":[\"Personal and Laundry Services\",\"Food Services and Drinking Places\",\"Truck Transportation\",\"Religious, Grantmaking, Civic, Professional, and Similar Organizations\",\"Administrative and Support Services\",\"Professional, Scientific, and Technical Services\",\"Heavy and Civil Engineering Construction\",\"Food and Beverage Stores\",\"Ambulatory Health Care Services\",\"Unclassified\",\"Furniture and Home Furnishings Stores\",\"Specialty Trade Contractors\",\"Insurance Carriers and Related Activities\",\"Educational Services\",\"Printing and Related Support Activities\",\"Nonstore Retailers\",\"Electronics and Appliance Stores\",\"Amusement, Gambling, and Recreation Industries\",\"Administrative and Support Services\",\"Administrative and Support Services\",\"Merchant Wholesalers, Durable Goods\",\"Ambulatory Health Care Services\",\"Professional, Scientific, and Technical Services\",\"Machinery Manufacturing\",\"Accommodation\",\"Ambulatory Health Care Services\",\"Food Services and Drinking Places\",\"Clothing and Clothing Accessories Stores\",\"Performing Arts, Spectator Sports, and Related Industries\",\"Personal and Laundry Services\",\"Performing Arts, Spectator Sports, and Related Industries\",\"Ambulatory Health Care Services\",\"Motor Vehicle and Parts Dealers\",\"Personal and Laundry Services\",\"Food Services and Drinking Places\",\"Professional, Scientific, and Technical Services\",\"Unclassified\",\"Professional, Scientific, and Technical Services\",\"Repair and Maintenance\",\"Merchant Wholesalers, Durable Goods\",\"Construction of Buildings\",\"Professional, Scientific, and Technical Services\",\"Professional, Scientific, and Technical Services\",\"Food Services and Drinking Places\",\"Specialty Trade Contractors\",\"Real Estate\",\"Nursing and Residential Care Facilities\",\"Food and Beverage Stores\",\"Food Services and Drinking Places\",\"Chemical Manufacturing\",\"Professional, Scientific, and Technical Services\",\"Administrative and Support Services\",\"Merchant Wholesalers, Nondurable Goods\",\"Nursing and Residential Care Facilities\",\"Social Assistance\",\"Funds, Trusts, and Other Financial Vehicles\",\"Couriers and Messengers\",\"Ambulatory Health Care Services\",\"Professional, Scientific, and Technical Services\",\"Accommodation\",null,\"Food Services and Drinking Places\",\"Real Estate\",\"Specialty Trade Contractors\",\"Real Estate\",\"Ambulatory Health Care Services\",null,\"Professional, Scientific, and Technical Services\",\"Real Estate\",\"Transit and Ground Passenger Transportation\",\"Securities, Commodity Contracts, and Other Financial Investments and Related Activities\",\"Administrative and Support Services\",\"Professional, Scientific, and Technical Services\",\"Professional, Scientific, and Technical Services\",\"Real Estate\",\"Personal and Laundry Services\",\"Professional, Scientific, and Technical Services\",\"Personal and Laundry Services\",\"Miscellaneous Store Retailers\",\"Real Estate\",\"Food Manufacturing\",\"Personal and Laundry Services\",\"Repair and Maintenance\",\"Ambulatory Health Care Services\",\"Ambulatory Health Care Services\",\"Amusement, Gambling, and Recreation Industries\",\"Personal and Laundry Services\",\"Administrative and Support Services\",\"Specialty Trade Contractors\",\"Ambulatory Health Care Services\",\"Professional, Scientific, and Technical Services\",\"Personal and Laundry Services\",\"Insurance Carriers and Related Activities\",\"Food Services and Drinking Places\",\"Miscellaneous Manufacturing\",\"Credit Intermediation and Related Activities\",\"Religious, Grantmaking, Civic, Professional, and Similar Organizations\",\"Construction of Buildings\",\"Specialty Trade Contractors\",\"Real Estate\"],\"naics_desc\":[\"Beauty Salons\",\"Limited-Service Restaurants\",\"General Freight Trucking, Local\",\"Religious Organizations\",\"All Other Business Support Services\",\"Offices of Certified Public Accountants\",\"Water and Sewer Line and Related Structures Construction\",\"All Other Specialty Food Stores\",\"Offices of Physicians (except Mental Health Specialists)\",\"Unclassified\",\"Furniture Stores\",\"Plumbing, Heating, and Air-Conditioning Contractors\",\"Insurance Agencies and Brokerages\",\"All Other Miscellaneous Schools and Instruction\",\"Commercial Printing (except Screen and Books)\",\"Electronic Shopping and Mail-Order Houses\",\"Electronics Stores\",\"All Other Amusement and Recreation Industries\",\"Janitorial Services\",\"Exterminating and Pest Control Services\",\"Transportation Equipment and Supplies (except Motor Vehicle) Merchant Wholesalers\",\"Offices of Physicians (except Mental Health Specialists)\",\"Veterinary Services\",\"Turbine and Turbine Generator Set Units Manufacturing\",\"Hotels (except Casino Hotels) and Motels\",\"Freestanding Ambulatory Surgical and Emergency Centers\",\"Mobile Food Services\",\"Women's Clothing Stores\",\"Agents and Managers for Artists, Athletes, Entertainers, and Other Public Figures\",\"All Other Personal Services\",\"Musical Groups and Artists\",\"Offices of Physicians (except Mental Health Specialists)\",\"Tire Dealers\",\"Nail Salons\",\"Mobile Food Services\",\"Payroll Services\",\"Unclassified\",\"Other Computer Related Services\",\"Other Personal and Household Goods Repair and Maintenance\",\"Jewelry, Watch, Precious Stone, and Precious Metal Merchant Wholesalers\",\"Residential Remodelers\",\"Other Computer Related Services\",\"Photography Studios, Portrait\",\"Limited-Service Restaurants\",\"Electrical Contractors and Other Wiring Installation Contractors\",\"Offices of Real Estate Agents and Brokers\",\"Assisted Living Facilities for the Elderly\",\"All Other Specialty Food Stores\",\"Caterers\",\"Paint and Coating Manufacturing\",\"Offices of Certified Public Accountants\",\"Landscaping Services\",\"Beer and Ale Merchant Wholesalers\",\"Other Residential Care Facilities\",\"Child Day Care Services\",\"Trusts, Estates, and Agency Accounts\",\"Couriers and Express Delivery Services\",\"Offices of Optometrists\",\"Other Management Consulting Services\",\"Hotels (except Casino Hotels) and Motels\",null,\"Limited-Service Restaurants\",\"Offices of Real Estate Agents and Brokers\",\"Flooring Contractors\",\"Other Activities Related to Real Estate\",\"Diagnostic Imaging Centers\",null,\"Administrative Management and General Management Consulting Services\",\"Offices of Real Estate Agents and Brokers\",\"Taxi Service\",\"Investment Advice\",\"Carpet and Upholstery Cleaning Services\",\"Other Accounting Services\",\"All Other Professional, Scientific, and Technical Services\",\"Offices of Real Estate Agents and Brokers\",\"Barber Shops\",\"All Other Professional, Scientific, and Technical Services\",\"Beauty Salons\",\"Tobacco Stores\",\"Offices of Real Estate Appraisers\",\"Perishable Prepared Food Manufacturing\",\"Beauty Salons\",\"Car Washes\",\"Offices of All Other Miscellaneous Health Practitioners\",\"Offices of Physicians (except Mental Health Specialists)\",\"Fitness and Recreational Sports Centers\",\"Nail Salons\",\"All Other Support Services\",\"Plumbing, Heating, and Air-Conditioning Contractors\",\"Offices of Dentists\",\"All Other Legal Services\",\"Beauty Salons\",\"Insurance Agencies and Brokerages\",\"Full-Service Restaurants\",\"Dental Laboratories\",\"Sales Financing\",\"Civic and Social Organizations\",\"Residential Remodelers\",\"Painting and Wall Covering Contractors\",\"Offices of Real Estate Agents and Brokers\"],\"amount\":[3626,14669.76,1962,177300,89375,5260,393000,35000,26200,11162,137000,32500,45701.04,6382,20800,4667,1782.5,109442,20833,26702,92247.82,170287,88750,97370,24245,249900,19165,20208,7454,20685,370447,8880,64800,69592,37669.44,43596,4500,11458,19957.5,19963,95700,20000,12334,73200,10750,7356,5000,3928.96,29165,70600,43610,31800,32300,2027035,3990,26907,71342,26100,5840,631000,7832,26369,1030.21,3970,20832,6922,264358,30720,1582,4400,83832,15500,3638,5916,16977,10936,29080,8750,65143.02,29995,15416,2056.72,9400,1806,416867,30111,7516,20833,7860,95300,11000,7000,3900,51821,8966,19992,43690,15052,82550,20100]},\"columns\":[{\"id\":\"Borrower\",\"name\":\"Borrower\",\"type\":\"character\"},{\"id\":\"city\",\"name\":\"city\",\"type\":\"character\"},{\"id\":\"naics_code\",\"name\":\"naics_code\",\"type\":\"character\"},{\"id\":\"sector_desc\",\"name\":\"sector_desc\",\"type\":\"character\"},{\"id\":\"subsector_desc\",\"name\":\"subsector_desc\",\"type\":\"character\"},{\"id\":\"naics_desc\",\"name\":\"naics_desc\",\"type\":\"character\"},{\"id\":\"amount\",\"name\":\"amount\",\"type\":\"numeric\"}],\"style\":{\"fontSize\":\"smaller\"},\"dataKey\":\"ba93c5c14d063de09b91ce4b08ed53fc\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\nThink about what this  means: You now have another  thing for grouping, so you can see, for instance, how much went to restaurants, or which restaurants on your block got loans. \n\n\n\n## Joining risks \n\n### joining tl;dr \n\nThere are lots of risks in joining tables that you created yourself, or that were created outside a big relational database system. Keep an eye on the number of rows returned every time that you join -- you should know what to expect. \n\n### Double counting with joins\n\nWe won't go into this in depth, but just be aware it's easy to double-count rows when you join.  Here's a made-up  example, in which a zip code is on the border and is in two counties:\n\nSay you want to use some data on zip codes : \n\nzip code | county | info\n--- | --- | ---\n85232 | Maricopa | some data\n85232 | Pinal | some more data\n\nand match it to a list of restaurants in a zip code: \n\nzip code | restaurant name\n--- | ---\n85232 | My favorite restaurant\n85232 | My second-favorite restaurant\n\nWhen you match these, you'll get **4** rows: \n\nzip code | county | info | restaurant name\n---  | --- | --- | --- \n85232  | Maricopa | some data | My favorite restaurant\n85232  | Pinal    | some more data | My favorite restaurant\n85232  | Maricopa | some data | My second-favorite restaurant\n85232  | Pinal | some more data | My second-favority restaurant\n\nNow, every time you try to count restaurants, these two will be double-counted.\n\nIn computing, this is called a \"many-to-many\" relationship -- there are many rows of zip codes and many rows of restaurants. In journalism, we call it spaghetti. It's usually an unintended mess.\n\n### Losing rows with joins\n\nThe opposite can occur if you aren't careful and there are items you want to keep that are missing in your reference table. That's what happened in the immunization data above for the seven schools that I couldn't find. \n\n## Resources\n\n* The \"[Relational data](https://r4ds.had.co.nz/relational-data.html)\" chapter in the R for Data Science textbook has details on exactly how a complex data set might fit together. \n\n* [An example using a superheroes dataset](https://stat545.com/join-cheatsheet.html#left_joinsuperheroes-publishers), from Stat 545 at the University of British Columbia",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"site_libs/react-17.0.0/react.min.js\"></script>\n<script src=\"site_libs/react-17.0.0/react-dom.min.js\"></script>\n<script src=\"site_libs/reactwidget-1.0.0/react-tools.js\"></script>\n<script src=\"site_libs/htmlwidgets-1.6.1/htmlwidgets.js\"></script>\n<link href=\"site_libs/reactable-0.4.3/reactable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/reactable-binding-0.4.3/reactable.js\"></script>\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}